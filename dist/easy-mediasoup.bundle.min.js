(function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,t.EasyMediasoup=e()}})(function(){var e=Math.abs,t=Math.min,r=Math.round,a=Math.pow,s;return function(){function s(d,e,r){function t(o,i){if(!e[o]){if(!d[o]){var l="function"==typeof require&&require;if(!i&&l)return l(o,!0);if(n)return n(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[o]={exports:{}};d[o][0].call(a.exports,function(e){var r=d[o][1][e];return t(r||e)},a,a.exports,s,d,e,r)}return e[o].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)t(r[a]);return t}return s}()({1:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var s=a(e("@babel/runtime/helpers/classCallCheck")),n=a(e("@babel/runtime/helpers/createClass")),o=a(e("debug")),i="mediasoup-demo",d=function(){function e(t){(0,s["default"])(this,e),t?(this._debug=(0,o["default"])("".concat(i,":").concat(t)),this._warn=(0,o["default"])("".concat(i,":WARN:").concat(t)),this._error=(0,o["default"])("".concat(i,":ERROR:").concat(t))):(this._debug=(0,o["default"])(i),this._warn=(0,o["default"])("".concat(i,":WARN")),this._error=(0,o["default"])("".concat(i,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,n["default"])(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();r["default"]=d},{"@babel/runtime/helpers/classCallCheck":21,"@babel/runtime/helpers/createClass":22,"@babel/runtime/helpers/interopRequireDefault":24,debug:36}],2:[function(e,t,r){"use strict";function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function n(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?s(Object(r),!0).forEach(function(t){(0,c["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var o=e("@babel/runtime/helpers/interopRequireWildcard"),i=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var d=i(e("@babel/runtime/regenerator")),c=i(e("@babel/runtime/helpers/defineProperty")),p=i(e("@babel/runtime/helpers/asyncToGenerator")),l=i(e("@babel/runtime/helpers/objectWithoutProperties")),m=i(e("@babel/runtime/helpers/classCallCheck")),u=i(e("@babel/runtime/helpers/createClass")),f=i(e("protoo-client")),g=o(e("mediasoup-client")),_=i(e("./Logger")),b=e("./urlFactory"),y=o(e("./cookiesManager")),h=o(e("./redux/requestActions")),P=o(e("./redux/stateActions")),v={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}}},S={optional:[{googDscp:!0}]},R=[{maxBitrate:18e4,scaleResolutionDownBy:4},{maxBitrate:36e4,scaleResolutionDownBy:2},{maxBitrate:15e5,scaleResolutionDownBy:1}],C=[{scalabilityMode:"S3T3_KEY"}],x=[{scalabilityMode:"S3T3",dtx:!0}],T=new _["default"]("RoomClient"),D=function(){function e(t){var r=t.roomId,a=t.peerId,s=t.displayName,n=t.device,o=t.handler,i=t.useSimulcast,d=t.useSharingSimulcast,c=t.forceTcp,p=t.produce,u=t.consume,f=t.forceH264,g=t.forceVP9,_=t.svc,y=t.datachannel,h=t.externalVideo,P=t.media_server_wss,S=(0,l["default"])(t,["roomId","peerId","displayName","device","handler","useSimulcast","useSharingSimulcast","forceTcp","produce","consume","forceH264","forceVP9","svc","datachannel","externalVideo","media_server_wss"]);(0,m["default"])(this,e),T.debug("constructor() [roomId:\"%s\", peerId:\"%s\", displayName:\"%s\", device:%s]",r,a,s,n.flag),k=S.video_constrains||v,w=S.video_encodings||R,this.turnservers=S.turnservers,this._closed=!1,this._displayName=s,this._device=n,this._forceTcp=c,this._produce=p,this._consume=u,this._useDataChannel=y,this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,h&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.muted=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src="/resources/videos/video-audio-stereo.mp4",this._externalVideo.play()["catch"](function(e){return T.warn("externalVideo.play() failed:%o",e)})),this._handler=o,this._useSimulcast=i,this._useSharingSimulcast=d,this._protooUrl=(0,b.getProtooUrl)({media_server_wss:P,roomId:r,peerId:a,forceH264:f,forceVP9:g}),this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._webcams=new Map,this._webcam={device:S.camDeviceId?{deviceId:S.camDeviceId}:null,resolution:"hd"},this._mic={device:S.micDeviceId?{deviceId:S.micDeviceId}:null},_&&(x[0].scalabilityMode=_,C[0].scalabilityMode="".concat(_,"_KEY")),this.join()}return(0,u["default"])(e,null,[{key:"init",value:function(e){I=e.store}}]),(0,u["default"])(e,[{key:"close",value:function(){this._closed||(this._closed=!0,T.debug("close()"),this._protoo.close(),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),I.dispatch(P.setRoomState("closed")))}},{key:"join",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this,r;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=new f["default"].WebSocketTransport(this._protooUrl),this._protoo=new f["default"].Peer(r),I.dispatch(P.setRoomState("connecting")),this._protoo.on("open",function(){return t._joinRoom()}),this._protoo.on("failed",function(){I.dispatch(h.notify({type:"error",text:"WebSocket connection failed"}))}),this._protoo.on("disconnected",function(){I.dispatch(h.notify({type:"error",text:"WebSocket disconnected"})),t._sendTransport&&(t._sendTransport.close(),t._sendTransport=null),t._recvTransport&&(t._recvTransport.close(),t._recvTransport=null),I.dispatch(P.setRoomState("closed"))}),this._protoo.on("close",function(){t._closed||t.close()}),this._protoo.on("request",function(){var e=(0,p["default"])(d["default"].mark(function e(r,s,o){var i,c,p,l,m,u,f,_,b,y,v,S,R,C,x,D,k,w,E,O,M,L,A;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:T.debug("proto \"request\" event [method:%s, data:%o]",r.method,r.data),e.t0=r.method,e.next="newConsumer"===e.t0?4:"newDataConsumer"===e.t0?26:53;break;case 4:if(t._consume){e.next=7;break}return o(403,"I do not want to consume"),e.abrupt("return");case 7:return i=r.data,c=i.peerId,p=i.producerId,l=i.id,m=i.kind,u=i.rtpParameters,f=i.type,_=i.appData,b=i.producerPaused,"audio"===m&&(y={opusStereo:1}),e.prev=9,e.next=12,t._recvTransport.consume({id:l,producerId:p,kind:m,rtpParameters:u,codecOptions:y,appData:n({},_,{peerId:c})});case 12:v=e.sent,t._consumers.set(v.id,v),v.on("transportclose",function(){t._consumers["delete"](v.id)}),S=g.parseScalabilityMode(v.rtpParameters.encodings[0].scalabilityMode),R=S.spatialLayers,C=S.temporalLayers,I.dispatch(P.addConsumer({id:v.id,type:f,locallyPaused:!1,remotelyPaused:b,rtpParameters:v.rtpParameters,spatialLayers:R,temporalLayers:C,preferredSpatialLayer:R-1,preferredTemporalLayer:C-1,priority:1,codec:v.rtpParameters.codecs[0].mimeType.split("/")[1],track:v.track},c)),s(),"video"===v.kind&&I.getState().me.audioOnly&&t._pauseConsumer(v),e.next=25;break;case 21:e.prev=21,e.t1=e["catch"](9),T.error("\"newConsumer\" request failed:%o",e.t1),I.dispatch(h.notify({type:"error",text:"Error creating a Consumer: ".concat(e.t1)}));case 25:return e.abrupt("break",53);case 26:if(t._consume){e.next=29;break}return o(403,"I do not want to data consume"),e.abrupt("return");case 29:if(t._useDataChannel){e.next=32;break}return o(403,"I do not want DataChannels"),e.abrupt("return");case 32:return x=r.data,D=x.peerId,k=x.dataProducerId,w=x.id,E=x.sctpStreamParameters,O=x.label,M=x.protocol,L=x.appData,e.prev=33,e.next=36,t._recvTransport.consumeData({id:w,dataProducerId:k,sctpStreamParameters:E,label:O,protocol:M,appData:n({},L,{peerId:D})});case 36:A=e.sent,t._dataConsumers.set(A.id,A),A.on("transportclose",function(){t._dataConsumers["delete"](A.id)}),A.on("open",function(){T.debug("DataConsumer \"open\" event")}),A.on("close",function(){T.warn("DataConsumer \"close\" event"),t._dataConsumers["delete"](A.id),I.dispatch(h.notify({type:"error",text:"DataConsumer closed"}))}),A.on("error",function(e){T.error("DataConsumer \"error\" event:%o",e),I.dispatch(h.notify({type:"error",text:"DataConsumer error: ".concat(e)}))}),A.on("message",function(e){if(T.debug("DataConsumer \"message\" event [streamId:%d]",A.sctpStreamParameters.streamId),window.DC_MESSAGE=e,e instanceof ArrayBuffer){var r=new DataView(e),s=r.getUint32();return s==a(2,32)-1?(T.warn("dataChannelTest finished!"),void(t._nextDataChannelTestNumber=0)):(s>t._nextDataChannelTestNumber&&T.warn("dataChannelTest: %s packets missing",s-t._nextDataChannelTestNumber),void(t._nextDataChannelTestNumber=s+1))}if("string"!=typeof e)return void T.warn("ignoring DataConsumer \"message\" (not a string)");switch(A.label){case"chat":{var n=I.getState(),o=n.peers,i=Object.keys(o).map(function(e){return o[e]}),d=i.find(function(e){return e.dataConsumers.includes(A.id)});d||T.warn("DataConsumer \"message\" from unknown peer"),I.dispatch(h.notify({title:"".concat(d.displayName," says:"),text:e,timeout:5e3}));break}case"bot":{I.dispatch(h.notify({title:"Message from Bot:",text:e,timeout:5e3}));break}}}),window.DC=A,I.dispatch(P.addDataConsumer({id:A.id,sctpStreamParameters:A.sctpStreamParameters,label:A.label,protocol:A.protocol},D)),s(),e.next=52;break;case 48:e.prev=48,e.t2=e["catch"](33),T.error("\"newDataConsumer\" request failed:%o",e.t2),I.dispatch(h.notify({type:"error",text:"Error creating a DataConsumer: ".concat(e.t2)}));case 52:return e.abrupt("break",53);case 53:case"end":return e.stop();}},e,null,[[9,21],[33,48]])}));return function(){return e.apply(this,arguments)}}()),this._protoo.on("notification",function(e){switch(T.debug("proto \"notification\" event [method:%s, data:%o]",e.method,e.data),e.method){case"producerScore":{var r=e.data,a=r.producerId,s=r.score;I.dispatch(P.setProducerScore(a,s));break}case"newPeer":{var o=e.data;I.dispatch(P.addPeer(n({},o,{consumers:[],dataConsumers:[]}))),I.dispatch(h.notify({text:"".concat(o.displayName," has joined the room")}));break}case"peerClosed":{var i=e.data.peerId;I.dispatch(P.removePeer(i));break}case"peerDisplayNameChanged":{var d=e.data,c=d.peerId,p=d.displayName,l=d.oldDisplayName;I.dispatch(P.setPeerDisplayName(p,c)),I.dispatch(h.notify({text:"".concat(l," is now ").concat(p)}));break}case"consumerClosed":{var m=e.data.consumerId,u=t._consumers.get(m);if(!u)break;u.close(),t._consumers["delete"](m);var f=u.appData.peerId;I.dispatch(P.removeConsumer(m,f));break}case"consumerPaused":{var g=e.data.consumerId,_=t._consumers.get(g);if(!_)break;I.dispatch(P.setConsumerPaused(g,"remote"));break}case"consumerResumed":{var b=e.data.consumerId,y=t._consumers.get(b);if(!y)break;I.dispatch(P.setConsumerResumed(b,"remote"));break}case"consumerLayersChanged":{var v=e.data,S=v.consumerId,R=v.spatialLayer,C=v.temporalLayer,x=t._consumers.get(S);if(!x)break;I.dispatch(P.setConsumerCurrentLayers(S,R,C));break}case"consumerScore":{var D=e.data,k=D.consumerId,w=D.score;I.dispatch(P.setConsumerScore(k,w));break}case"dataConsumerClosed":{var E=e.data.dataConsumerId,O=t._dataConsumers.get(E);if(!O)break;O.close(),t._dataConsumers["delete"](E);var M=O.appData.peerId;I.dispatch(P.removeDataConsumer(E,M));break}case"activeSpeaker":{var L=e.data.peerId;I.dispatch(P.setRoomActiveSpeaker(L));break}default:T.error("unknown protoo notification.method \"%s\"",e.method);}});case 9:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"enableMic",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this,r,a,s,n;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("enableMic()"),!this._micProducer){e.next=3;break}return e.abrupt("return");case 3:if(this._mediasoupDevice.canProduce("audio")){e.next=6;break}return T.error("enableMic() | cannot produce audio"),e.abrupt("return");case 6:if(e.prev=6,this._externalVideo){e.next=16;break}return T.debug("enableMic() | calling getUserMedia()"),a=this._mic.device?this._mic.device.deviceId:null,e.next=12,navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:a}}});case 12:s=e.sent,r=s.getAudioTracks()[0],e.next=20;break;case 16:return e.next=18,this._getExternalVideoStream();case 18:n=e.sent,r=n.getAudioTracks()[0].clone();case 20:return e.next=22,this._sendTransport.produce({track:r,codecOptions:{opusStereo:1,opusDtx:1}});case 22:this._micProducer=e.sent,I.dispatch(P.addProducer({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1]})),this._micProducer.on("transportclose",function(){t._micProducer=null}),this._micProducer.on("trackended",function(){I.dispatch(h.notify({type:"error",text:"Microphone disconnected!"})),t.disableMic()["catch"](function(){})}),e.next=33;break;case 28:e.prev=28,e.t0=e["catch"](6),T.error("enableMic() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error enabling microphone: ".concat(e.t0)})),r&&r.stop();case 33:case"end":return e.stop();}},e,this,[[6,28]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableMic",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("disableMic()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return this._micProducer.close(),I.dispatch(P.removeProducer(this._micProducer.id)),e.prev=5,e.next=8,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),I.dispatch(h.notify({type:"error",text:"Error closing server-side mic Producer: ".concat(e.t0)}));case 13:this._micProducer=null;case 14:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"muteMic",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("muteMic()"),this._micProducer.pause(),e.prev=2,e.next=5,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 5:I.dispatch(P.setProducerPaused(this._micProducer.id)),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](2),T.error("muteMic() | failed: %o",e.t0),I.dispatch(h.notify({type:"error",text:"Error pausing server-side mic Producer: ".concat(e.t0)}));case 12:case"end":return e.stop();}},e,this,[[2,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"unmuteMic",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("unmuteMic()"),this._micProducer.resume(),e.prev=2,e.next=5,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 5:I.dispatch(P.setProducerResumed(this._micProducer.id)),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](2),T.error("unmuteMic() | failed: %o",e.t0),I.dispatch(h.notify({type:"error",text:"Error resuming server-side mic Producer: ".concat(e.t0)}));case 12:case"end":return e.stop();}},e,this,[[2,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableWebcam",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this,r,a,s,o,i,c,p;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("enableWebcam()"),!this._webcamProducer){e.next=5;break}return e.abrupt("return");case 5:if(!this._shareProducer){e.next=8;break}return e.next=8,this.disableShare();case 8:if(this._mediasoupDevice.canProduce("video")){e.next=11;break}return T.error("enableWebcam() | cannot produce video"),e.abrupt("return");case 11:if(I.dispatch(P.setWebcamInProgress(!0)),e.prev=12,this._externalVideo){e.next=27;break}return e.next=16,this._updateWebcams();case 16:if(a=this._webcam.device,s=this._webcam.resolution,a){e.next=20;break}throw new Error("no webcam devices");case 20:return T.debug("enableWebcam() | calling getUserMedia()"),e.next=23,navigator.mediaDevices.getUserMedia({video:n({deviceId:{exact:a.deviceId}},k[s])});case 23:o=e.sent,r=o.getVideoTracks()[0],e.next=32;break;case 27:return a={label:"external video"},e.next=30,this._getExternalVideoStream();case 30:i=e.sent,r=i.getVideoTracks()[0].clone();case 32:if(!this._useSimulcast){e.next=40;break}return c=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),p="video/vp9"===c.mimeType.toLowerCase()?C:w,e.next=37,this._sendTransport.produce({track:r,encodings:p,codecOptions:{videoGoogleStartBitrate:1e3}});case 37:this._webcamProducer=e.sent,e.next=43;break;case 40:return e.next=42,this._sendTransport.produce({track:r});case 42:this._webcamProducer=e.sent;case 43:I.dispatch(P.addProducer({id:this._webcamProducer.id,deviceLabel:a.label,type:this._getWebcamType(a),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1]})),this._webcamProducer.on("transportclose",function(){t._webcamProducer=null}),this._webcamProducer.on("trackended",function(){I.dispatch(h.notify({type:"error",text:"Webcam disconnected!"})),t.disableWebcam()["catch"](function(){})}),e.next=53;break;case 48:e.prev=48,e.t0=e["catch"](12),T.error("enableWebcam() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error enabling webcam: ".concat(e.t0)})),r&&r.stop();case 53:I.dispatch(P.setWebcamInProgress(!1));case 54:case"end":return e.stop();}},e,this,[[12,48]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableWebcam",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("disableWebcam()"),this._webcamProducer){e.next=3;break}return e.abrupt("return");case 3:return this._webcamProducer.close(),I.dispatch(P.removeProducer(this._webcamProducer.id)),e.prev=5,e.next=8,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),I.dispatch(h.notify({type:"error",text:"Error closing server-side webcam Producer: ".concat(e.t0)}));case 13:this._webcamProducer=null;case 14:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeMic",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r,a;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("changeWebcam()"),e.prev=1,t=this._mic.device?this._mic.device.deviceId:"default",this._micProducer.track.stop(),e.next=6,navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:t}}});case 6:return r=e.sent,a=r.getVideoTracks()[0],e.next=10,this._micProducer.replaceTrack({track:a});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](1),T.error("changeWebcam() | failed: %o",e.t0),I.dispatch(h.notify({type:"error",text:"Could not change webcam: ".concat(e.t0)}));case 16:I.dispatch(P.setWebcamInProgress(!1));case 17:case"end":return e.stop();}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeWebcam",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r,a,s,o,i;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("changeWebcam()"),I.dispatch(P.setWebcamInProgress(!0)),e.prev=2,e.next=5,this._updateWebcams();case 5:if(t=Array.from(this._webcams.keys()),r=t.length,a=this._webcam.device?this._webcam.device.deviceId:void 0,s=t.indexOf(a),s<r-1?s++:s=0,this._webcam.device=this._webcams.get(t[s]),T.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution="hd",this._webcam.device){e.next=15;break}throw new Error("no webcam devices");case 15:return this._webcamProducer.track.stop(),T.debug("changeWebcam() | calling getUserMedia()"),e.next=19,navigator.mediaDevices.getUserMedia({video:n({deviceId:{exact:this._webcam.device.deviceId}},k[this._webcam.resolution])});case 19:return o=e.sent,i=o.getVideoTracks()[0],e.next=23,this._webcamProducer.replaceTrack({track:i});case 23:I.dispatch(P.setProducerTrack(this._webcamProducer.id,i)),e.next=30;break;case 26:e.prev=26,e.t0=e["catch"](2),T.error("changeWebcam() | failed: %o",e.t0),I.dispatch(h.notify({type:"error",text:"Could not change webcam: ".concat(e.t0)}));case 30:I.dispatch(P.setWebcamInProgress(!1));case 31:case"end":return e.stop();}},e,this,[[2,26]])}));return function(){return e.apply(this,arguments)}}()},{key:"changeWebcamResolution",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:T.debug("changeWebcamResolution()"),I.dispatch(P.setWebcamInProgress(!0)),e.prev=2,e.t0=this._webcam.resolution,e.next="qvga"===e.t0?6:"vga"===e.t0?8:"hd"===e.t0?10:12;break;case 6:return this._webcam.resolution="vga",e.abrupt("break",13);case 8:return this._webcam.resolution="hd",e.abrupt("break",13);case 10:return this._webcam.resolution="qvga",e.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return T.debug("changeWebcamResolution() | calling getUserMedia()"),e.next=16,navigator.mediaDevices.getUserMedia({video:n({deviceId:{exact:this._webcam.device.deviceId}},k[this._webcam.resolution])});case 16:return t=e.sent,r=t.getVideoTracks()[0],e.next=20,this._webcamProducer.replaceTrack({track:r});case 20:I.dispatch(P.setProducerTrack(this._webcamProducer.id,r)),e.next=27;break;case 23:e.prev=23,e.t1=e["catch"](2),T.error("changeWebcamResolution() | failed: %o",e.t1),I.dispatch(h.notify({type:"error",text:"Could not change webcam resolution: ".concat(e.t1)}));case 27:I.dispatch(P.setWebcamInProgress(!1));case 28:case"end":return e.stop();}},e,this,[[2,23]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableShare",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this,r,a,s,o;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("enableShare()"),!this._shareProducer){e.next=5;break}return e.abrupt("return");case 5:if(!this._webcamProducer){e.next=8;break}return e.next=8,this.disableWebcam();case 8:if(this._mediasoupDevice.canProduce("video")){e.next=11;break}return T.error("enableShare() | cannot produce video"),e.abrupt("return");case 11:return I.dispatch(P.setShareInProgress(!0)),e.prev=12,T.debug("enableShare() | calling getUserMedia()"),e.next=16,navigator.mediaDevices.getDisplayMedia({audio:!1,video:{displaySurface:"monitor",logicalSurface:!0,cursor:!0,width:{max:1920},height:{max:1080},frame:{max:30}}});case 16:if(a=e.sent,a){e.next=20;break}return I.dispatch(P.setShareInProgress(!0)),e.abrupt("return");case 20:if(r=a.getVideoTracks()[0],!this._useSharingSimulcast){e.next=29;break}return s=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),o="video/vp9"===s.mimeType.toLowerCase()?x:w.map(function(e){return n({},e,{dtx:!0})}),e.next=26,this._sendTransport.produce({track:r,encodings:o,codecOptions:{videoGoogleStartBitrate:1e3},appData:{share:!0}});case 26:this._shareProducer=e.sent,e.next=32;break;case 29:return e.next=31,this._sendTransport.produce({track:r});case 31:this._shareProducer=e.sent;case 32:I.dispatch(P.addProducer({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1]})),this._shareProducer.on("transportclose",function(){t._shareProducer=null}),this._shareProducer.on("trackended",function(){I.dispatch(h.notify({type:"error",text:"Share disconnected!"})),t.disableShare()["catch"](function(){})}),e.next=42;break;case 37:e.prev=37,e.t0=e["catch"](12),T.error("enableShare() | failed:%o",e.t0),"NotAllowedError"!==e.t0.name&&I.dispatch(h.notify({type:"error",text:"Error sharing: ".concat(e.t0)})),r&&r.stop();case 42:I.dispatch(P.setShareInProgress(!1));case 43:case"end":return e.stop();}},e,this,[[12,37]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableShare",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("disableShare()"),this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return this._shareProducer.close(),I.dispatch(P.removeProducer(this._shareProducer.id)),e.prev=5,e.next=8,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),I.dispatch(h.notify({type:"error",text:"Error closing server-side share Producer: ".concat(e.t0)}));case 13:this._shareProducer=null;case 14:case"end":return e.stop();}},e,this,[[5,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableAudioOnly",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r,a,s,n,o;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:T.debug("enableAudioOnly()"),I.dispatch(P.setAudioOnlyInProgress(!0)),this.disableWebcam(),t=!0,r=!1,a=void 0,e.prev=6,s=this._consumers.values()[Symbol.iterator]();case 8:if(t=(n=s.next()).done){e.next=16;break}if(o=n.value,"video"===o.kind){e.next=12;break}return e.abrupt("continue",13);case 12:this._pauseConsumer(o);case 13:t=!0,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](6),r=!0,a=e.t0;case 22:e.prev=22,e.prev=23,t||null==s["return"]||s["return"]();case 25:if(e.prev=25,!r){e.next=28;break}throw a;case 28:return e.finish(25);case 29:return e.finish(22);case 30:I.dispatch(P.setAudioOnlyState(!0)),I.dispatch(P.setAudioOnlyInProgress(!1));case 32:case"end":return e.stop();}},e,this,[[6,18,22,30],[23,,25,29]])}));return function(){return e.apply(this,arguments)}}()},{key:"disableAudioOnly",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r,a,s,n,o;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:T.debug("disableAudioOnly()"),I.dispatch(P.setAudioOnlyInProgress(!0)),!this._webcamProducer&&this._produce&&(y.getDevices()||{}).webcamEnabled&&this.enableWebcam(),t=!0,r=!1,a=void 0,e.prev=6,s=this._consumers.values()[Symbol.iterator]();case 8:if(t=(n=s.next()).done){e.next=16;break}if(o=n.value,"video"===o.kind){e.next=12;break}return e.abrupt("continue",13);case 12:this._resumeConsumer(o);case 13:t=!0,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](6),r=!0,a=e.t0;case 22:e.prev=22,e.prev=23,t||null==s["return"]||s["return"]();case 25:if(e.prev=25,!r){e.next=28;break}throw a;case 28:return e.finish(25);case 29:return e.finish(22);case 30:I.dispatch(P.setAudioOnlyState(!1)),I.dispatch(P.setAudioOnlyInProgress(!1));case 32:case"end":return e.stop();}},e,this,[[6,18,22,30],[23,,25,29]])}));return function(){return e.apply(this,arguments)}}()},{key:"muteAudio",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:T.debug("muteAudio()"),I.dispatch(P.setAudioMutedState(!0));case 2:case"end":return e.stop();}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"unmuteAudio",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:T.debug("unmuteAudio()"),I.dispatch(P.setAudioMutedState(!1));case 2:case"end":return e.stop();}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("restartIce()"),I.dispatch(P.setRestartIceInProgress(!0)),e.prev=2,!this._sendTransport){e.next=9;break}return e.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return t=e.sent,e.next=9,this._sendTransport.restartIce({iceParameters:t});case 9:if(!this._recvTransport){e.next=15;break}return e.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return r=e.sent,e.next=15,this._recvTransport.restartIce({iceParameters:r});case 15:I.dispatch(h.notify({text:"ICE restarted"})),e.next=22;break;case 18:e.prev=18,e.t0=e["catch"](2),T.error("restartIce() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"ICE restart failed: ".concat(e.t0)}));case 22:I.dispatch(P.setRestartIceInProgress(!1));case 23:case"end":return e.stop();}},e,this,[[2,18]])}));return function(){return e.apply(this,arguments)}}()},{key:"setMaxSendingSpatialLayer",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this._webcamProducer){e.next=7;break}return e.next=5,this._webcamProducer.setMaxSpatialLayer(t);case 5:e.next=10;break;case 7:if(!this._shareProducer){e.next=10;break}return e.next=10,this._shareProducer.setMaxSpatialLayer(t);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](1),T.error("setMaxSendingSpatialLayer() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error setting max sending video spatial layer: ".concat(e.t0)}));case 16:case"end":return e.stop();}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"setConsumerPreferredLayers",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t,r,a){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,r,a),e.prev=1,e.next=4,this._protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:a});case 4:I.dispatch(P.setConsumerPreferredLayers(t,r,a)),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),T.error("setConsumerPreferredLayers() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error setting Consumer preferred layers: ".concat(e.t0)}));case 11:case"end":return e.stop();}},e,this,[[1,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"setConsumerPriority",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t,r){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("setConsumerPriority() [consumerId:%s, priority:%d]",t,r),e.prev=1,e.next=4,this._protoo.request("setConsumerPriority",{consumerId:t,priority:r});case 4:I.dispatch(P.setConsumerPriority(t,r)),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),T.error("setConsumerPriority() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error setting Consumer priority: ".concat(e.t0)}));case 11:case"end":return e.stop();}},e,this,[[1,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"requestConsumerKeyFrame",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("requestConsumerKeyFrame() [consumerId:%s]",t),e.prev=1,e.next=4,this._protoo.request("requestConsumerKeyFrame",{consumerId:t});case 4:I.dispatch(h.notify({text:"Keyframe requested for video consumer"})),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),T.error("requestConsumerKeyFrame() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error requesting key frame for Consumer: ".concat(e.t0)}));case 11:case"end":return e.stop();}},e,this,[[1,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableChatDataProducer",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("enableChatDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=e.sent,I.dispatch(P.addDataProducer({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",function(){t._chatDataProducer=null}),this._chatDataProducer.on("open",function(){T.debug("chat DataProducer \"open\" event")}),this._chatDataProducer.on("close",function(){T.error("chat DataProducer \"close\" event"),t._chatDataProducer=null,I.dispatch(h.notify({type:"error",text:"Chat DataProducer closed"}))}),this._chatDataProducer.on("error",function(e){T.error("chat DataProducer \"error\" event:%o",e),I.dispatch(h.notify({type:"error",text:"Chat DataProducer error: ".concat(e)}))}),this._chatDataProducer.on("bufferedamountlow",function(){T.debug("chat DataProducer \"bufferedamountlow\" event")}),e.next=20;break;case 15:throw e.prev=15,e.t0=e["catch"](3),T.error("enableChatDataProducer() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error enabling chat DataProducer: ".concat(e.t0)})),e.t0;case 20:case"end":return e.stop();}},e,this,[[3,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"enableBotDataProducer",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("enableBotDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=e.sent,I.dispatch(P.addDataProducer({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",function(){t._botDataProducer=null}),this._botDataProducer.on("open",function(){T.debug("bot DataProducer \"open\" event")}),this._botDataProducer.on("close",function(){T.error("bot DataProducer \"close\" event"),t._botDataProducer=null,I.dispatch(h.notify({type:"error",text:"Bot DataProducer closed"}))}),this._botDataProducer.on("error",function(e){T.error("bot DataProducer \"error\" event:%o",e),I.dispatch(h.notify({type:"error",text:"Bot DataProducer error: ".concat(e)}))}),this._botDataProducer.on("bufferedamountlow",function(){T.debug("bot DataProducer \"bufferedamountlow\" event")}),e.next=20;break;case 15:throw e.prev=15,e.t0=e["catch"](3),T.error("enableBotDataProducer() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error enabling bot DataProducer: ".concat(e.t0)})),e.t0;case 20:case"end":return e.stop();}},e,this,[[3,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendChatMessage",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("sendChatMessage() [text:\"%s]",t),this._chatDataProducer){e.next=4;break}return I.dispatch(h.notify({type:"error",text:"No chat DataProducer"})),e.abrupt("return");case 4:try{this._chatDataProducer.send(t)}catch(e){T.error("chat DataProducer.send() failed:%o",e),I.dispatch(h.notify({type:"error",text:"chat DataProducer.send() failed: ".concat(e)}))}case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendBotMessage",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("sendBotMessage() [text:\"%s]",t),this._botDataProducer){e.next=4;break}return I.dispatch(h.notify({type:"error",text:"No bot DataProducer"})),e.abrupt("return");case 4:try{this._botDataProducer.send(t)}catch(e){T.error("bot DataProducer.send() failed:%o",e),I.dispatch(h.notify({type:"error",text:"bot DataProducer.send() failed: ".concat(e)}))}case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"changeDisplayName",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("changeDisplayName() [displayName:\"%s\"]",t),y.setUser({displayName:t}),e.prev=2,e.next=5,this._protoo.request("changeDisplayName",{displayName:t});case 5:this._displayName=t,I.dispatch(P.setDisplayName(t)),I.dispatch(h.notify({text:"Display name changed"})),e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](2),T.error("changeDisplayName() | failed: %o",e.t0),I.dispatch(h.notify({type:"error",text:"Could not change display name: ".concat(e.t0)})),I.dispatch(P.setDisplayName());case 15:case"end":return e.stop();}},e,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"getSendTransportRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getSendTransportRemoteStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRecvTransportRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getRecvTransportRemoteStats()"),this._recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._recvTransport.id}));case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAudioRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getAudioRemoteStats()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getProducerStats",{producerId:this._micProducer.id}));case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getVideoRemoteStats()"),t=this._webcamProducer||this._shareProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getProducerStats",{producerId:t.id}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getConsumerRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){var r;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getConsumerRemoteStats()"),r=this._consumers.get(t),r){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getConsumerStats",{consumerId:t}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getChatDataProducerRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getChatDataProducerRemoteStats()"),t=this._chatDataProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getBotDataProducerRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getBotDataProducerRemoteStats()"),t=this._botDataProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDataConsumerRemoteStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){var r;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getDataConsumerRemoteStats()"),r=this._dataConsumers.get(t),r){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataConsumerStats",{dataConsumerId:t}));case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSendTransportLocalStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getSendTransportLocalStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._sendTransport.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRecvTransportLocalStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getRecvTransportLocalStats()"),this._recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._recvTransport.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAudioLocalStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getAudioLocalStats()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._micProducer.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getVideoLocalStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("getVideoLocalStats()"),t=this._webcamProducer||this._shareProducer,t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",t.getStats());case 5:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getConsumerLocalStats",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){var r;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._consumers.get(t),r){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"applyNetworkThrottle",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){var r,a,s,n;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,a=t.downlink,s=t.rtt,n=t.secret,T.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",r,a,s),e.prev=2,e.next=5,this._protoo.request("applyNetworkThrottle",{uplink:r,downlink:a,rtt:s,secret:n});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](2),T.error("applyNetworkThrottle() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error applying network throttle: ".concat(e.t0)}));case 11:case"end":return e.stop();}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"resetNetworkThrottle",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){var r,a,s;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,a=void 0!==r&&r,s=t.secret,T.debug("resetNetworkThrottle()"),e.prev=2,e.next=5,this._protoo.request("resetNetworkThrottle",{secret:s});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](2),a||(T.error("resetNetworkThrottle() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error resetting network throttle: ".concat(e.t0)})));case 10:case"end":return e.stop();}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"_joinRoom",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this,r,a,s,o,i,c,l,m,u,f,_,b,v,R,C,x,D,k,w,E,O,M,L,A,j,N,F;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("_joinRoom()"),e.prev=1,this._mediasoupDevice=new g.Device({Handler:this._handler}),e.next=5,this._protoo.request("getRouterRtpCapabilities");case 5:return r=e.sent,e.next=8,this._mediasoupDevice.load({routerRtpCapabilities:r});case 8:if(!this._produce){e.next=16;break}return a=this._mic.device?this._mic.device.deviceId:null,e.next=12,navigator.mediaDevices.getUserMedia({audio:{deviceId:a}});case 12:s=e.sent,o=s.getAudioTracks()[0],o.enabled=!1,setTimeout(function(){return o.stop()},12e4);case 16:if(!this._produce){e.next=25;break}return e.next=19,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 19:i=e.sent,c=i.id,l=i.iceParameters,m=i.iceCandidates,u=i.dtlsParameters,f=i.sctpParameters,this._sendTransport=this._mediasoupDevice.createSendTransport({id:c,iceParameters:l,iceServers:this.turnservers,iceCandidates:m,dtlsParameters:u,sctpParameters:f,proprietaryConstraints:S}),this._sendTransport.on("connect",function(e,r,a){var s=e.dtlsParameters;t._protoo.request("connectWebRtcTransport",{transportId:t._sendTransport.id,dtlsParameters:s}).then(r)["catch"](a)}),this._sendTransport.on("produce",function(){var e=(0,p["default"])(d["default"].mark(function e(r,a,s){var n,o,i,c,p;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.kind,o=r.rtpParameters,i=r.appData,e.prev=1,e.next=4,t._protoo.request("produce",{transportId:t._sendTransport.id,kind:n,rtpParameters:o,appData:i});case 4:c=e.sent,p=c.id,a({id:p}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),s(e.t0);case 12:case"end":return e.stop();}},e,null,[[1,9]])}));return function(){return e.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var e=(0,p["default"])(d["default"].mark(function e(r,a,s){var n,o,i,c,p,l;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.sctpStreamParameters,o=r.label,i=r.protocol,c=r.appData,T.debug("\"producedata\" event: [sctpStreamParameters:%o, appData:%o]",n,c),e.prev=2,e.next=5,t._protoo.request("produceData",{transportId:t._sendTransport.id,sctpStreamParameters:n,label:o,protocol:i,appData:c});case 5:p=e.sent,l=p.id,a({id:l}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),s(e.t0);case 13:case"end":return e.stop();}},e,null,[[2,10]])}));return function(){return e.apply(this,arguments)}}());case 25:if(!this._consume){e.next=32;break}return e.next=28,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 28:_=e.sent,b=_.id,v=_.iceParameters,R=_.iceCandidates,C=_.dtlsParameters,x=_.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:b,iceParameters:v,iceCandidates:R,dtlsParameters:C,sctpParameters:x}),this._recvTransport.on("connect",function(e,r,a){var s=e.dtlsParameters;t._protoo.request("connectWebRtcTransport",{transportId:t._recvTransport.id,dtlsParameters:s}).then(r)["catch"](a)});case 32:return e.next=34,this._protoo.request("join",{displayName:this._displayName,device:this._device,rtpCapabilities:this._consume?this._mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this._useDataChannel&&this._consume?this._mediasoupDevice.sctpCapabilities:void 0});case 34:for(D=e.sent,k=D.peers,I.dispatch(P.setRoomState("connected")),I.dispatch(P.removeAllNotifications()),I.dispatch(h.notify({text:"You are in the room!",timeout:3e3})),w=!0,E=!1,O=void 0,e.prev=42,M=k[Symbol.iterator]();!(w=(L=M.next()).done);w=!0)A=L.value,I.dispatch(P.addPeer(n({},A,{consumers:[],dataConsumers:[]})));e.next=50;break;case 46:e.prev=46,e.t0=e["catch"](42),E=!0,O=e.t0;case 50:e.prev=50,e.prev=51,w||null==M["return"]||M["return"]();case 53:if(e.prev=53,!E){e.next=56;break}throw O;case 56:return e.finish(53);case 57:return e.finish(50);case 58:this._produce&&(I.dispatch(P.setMediaCapabilities({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this.enableMic(),j=y.getDevices(),(!j||j.webcamEnabled||this._externalVideo)&&this.enableWebcam(),this._sendTransport.on("connectionstatechange",function(e){"connected"===e&&(t.enableChatDataProducer(),t.enableBotDataProducer())})),window.SHOW_INFO&&(N=I.getState(),F=N.me,I.dispatch(P.setRoomStatsPeerId(F.id))),e.next=67;break;case 62:e.prev=62,e.t1=e["catch"](1),T.error("_joinRoom() failed:%o",e.t1),I.dispatch(h.notify({type:"error",text:"Could not join the room: ".concat(e.t1)})),this.close();case 67:case"end":return e.stop();}},e,this,[[1,62],[42,46,50,58],[51,,53,57]])}));return function(){return e.apply(this,arguments)}}()},{key:"_updateWebcams",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t,r,a,s,n,o,i,c,p,l;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("_updateWebcams()"),this._webcams=new Map,T.debug("_updateWebcams() | calling enumerateDevices()"),e.next=5,navigator.mediaDevices.enumerateDevices();case 5:t=e.sent,r=!0,a=!1,s=void 0,e.prev=9,n=t[Symbol.iterator]();case 11:if(r=(o=n.next()).done){e.next=19;break}if(i=o.value,"videoinput"===i.kind){e.next=15;break}return e.abrupt("continue",16);case 15:this._webcams.set(i.deviceId,i);case 16:r=!0,e.next=11;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e["catch"](9),a=!0,s=e.t0;case 25:e.prev=25,e.prev=26,r||null==n["return"]||n["return"]();case 28:if(e.prev=28,!a){e.next=31;break}throw s;case 31:return e.finish(28);case 32:return e.finish(25);case 33:c=Array.from(this._webcams.values()),p=c.length,l=this._webcam.device?this._webcam.device.deviceId:void 0,T.debug("_updateWebcams() [webcams:%o]",c),0===p?this._webcam.device=null:!this._webcams.has(l)&&(this._webcam.device=c[0]),I.dispatch(P.setCanChangeWebcam(1<this._webcams.size));case 39:case"end":return e.stop();}},e,this,[[9,21,25,33],[26,,28,32]])}));return function(){return e.apply(this,arguments)}}()},{key:"_getWebcamType",value:function(e){return /(back|rear)/i.test(e.label)?(T.debug("_getWebcamType() | it seems to be a back camera"),"back"):(T.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("pauseConsumer",{consumerId:t.id});case 5:t.pause(),I.dispatch(P.setConsumerPaused(t.id,"local")),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](2),T.error("_pauseConsumer() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error pausing Consumer: ".concat(e.t0)}));case 13:case"end":return e.stop();}},e,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"_resumeConsumer",value:function(){var e=(0,p["default"])(d["default"].mark(function e(t){return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("resumeConsumer",{consumerId:t.id});case 5:t.resume(),I.dispatch(P.setConsumerResumed(t.id,"local")),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](2),T.error("_resumeConsumer() | failed:%o",e.t0),I.dispatch(h.notify({type:"error",text:"Error resuming Consumer: ".concat(e.t0)}));case 13:case"end":return e.stop();}},e,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"_getExternalVideoStream",value:function(){var e=(0,p["default"])(d["default"].mark(function e(){var t=this;return d["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._externalVideoStream){e.next=2;break}return e.abrupt("return",this._externalVideoStream);case 2:if(!(3>this._externalVideo.readyState)){e.next=5;break}return e.next=5,new Promise(function(e){return t._externalVideo.addEventListener("canplay",e)});case 5:if(!this._externalVideo.captureStream){e.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),e.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){e.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),e.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return e.abrupt("return",this._externalVideoStream);case 15:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),k,w,I;r["default"]=D},{"./Logger":1,"./cookiesManager":3,"./redux/requestActions":15,"./redux/stateActions":16,"./urlFactory":17,"@babel/runtime/helpers/asyncToGenerator":20,"@babel/runtime/helpers/classCallCheck":21,"@babel/runtime/helpers/createClass":22,"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24,"@babel/runtime/helpers/interopRequireWildcard":25,"@babel/runtime/helpers/objectWithoutProperties":28,"@babel/runtime/regenerator":32,"mediasoup-client":65,"protoo-client":76}],3:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.getUser=function(){return s["default"].getJSON("mediasoup-demo.user")},r.setUser=function(e){var t=e.displayName;s["default"].set("mediasoup-demo.user",{displayName:t})},r.getDevices=function(){return s["default"].getJSON("mediasoup-demo.devices")},r.setDevices=function(e){var t=e.webcamEnabled;s["default"].set("mediasoup-demo.devices",{webcamEnabled:t})};var s=a(e("js-cookie"))},{"@babel/runtime/helpers/interopRequireDefault":24,"js-cookie":39}],4:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(){var e=navigator.userAgent,t=s["default"].getParser(e),r;return r=t.satisfies({chrome:">=0",chromium:">=0"})?"chrome":t.satisfies({firefox:">=0"})?"firefox":t.satisfies({safari:">=0"})?"safari":t.satisfies({opera:">=0"})?"opera":t.satisfies({"microsoft edge":">=0"})?"edge":"unknown",{flag:r,name:t.getBrowserName(),version:t.getBrowserVersion()}};var s=a(e("bowser"));window.BOWSER=s["default"]},{"@babel/runtime/helpers/interopRequireDefault":24,bowser:34}],5:[function(e,t,a){(function(t,s){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function o(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?n(Object(r),!0).forEach(function(t){(0,p["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var i=e("@babel/runtime/helpers/interopRequireWildcard"),d=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(a,"__esModule",{value:!0}),a.Init=void 0;var c=d(e("@babel/runtime/regenerator")),p=d(e("@babel/runtime/helpers/defineProperty")),l=d(e("@babel/runtime/helpers/asyncToGenerator")),m=d(e("@babel/runtime/helpers/classCallCheck")),u=d(e("url-parse")),f=e("redux"),g=d(e("redux-thunk")),_=d(e("./Logger")),b=i(e("./utils")),y=d(e("./deviceInfo")),h=d(e("./RoomClient")),P=i(e("./redux/stateActions")),v=d(e("./redux/reducers")),S=i(e("wildemitter"));console.warn("Mediasoup-v3 lite client version ".concat("0.0.1"));a.Init=function e(a){var n=this;(0,m["default"])(this,e);var i=new _["default"],d=[g["default"]];s.emitter=this.emitter=new S["default"];var p=this.store=(0,f.createStore)(v["default"],void 0,f.applyMiddleware.apply(void 0,d)),R;window.STORE=p,h["default"].init({store:p}),b.initialize(),this.run=(0,l["default"])(c["default"].mark(function e(){var s,d,l,m,f,g,_,b,v,S,C,x,T,D,k,w,I,E,O,M,L,A,j,N,F,B,U,q,W,V,K,G,z;return c["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.debug("run() [environment:%s]",t.env.NODE_ENV),s=new u["default"](window.location.href,!0),d=a.peerId||r(1e8*Math.random()).toString(),l=a.roomId,m=a.displayName,f=a.media_server_wss,g=a.video_constrains,_=a.video_encodings,b=a.turnservers,v=s.query.handler,S=a.useSimulcast||"false"!==s.query.simulcast,C=a.useSharingSimulcast||"false"!==s.query.sharingSimulcast,x=a.forceTcp||"true"===s.query.forceTcp,T=!0==a.produce,D=!0==a.consume,k=a.forceH264||"true"===s.query.forceH264,w=a.forceVP9||"true"===s.query.forceVP9,I=a.svc||s.query.svc,E=a.datachannel||"false"!==s.query.datachannel,O=a.info||"true"===s.query.info,M=a.faceDetection||"true"===s.query.faceDetection,L=a.externalVideo||"true"===s.query.externalVideo,A=a.throttleSecret||s.query.throttleSecret,j=a.cam_device_id||"default",N=a.mic_device_id||"default",F={video_constrains:g,video_encodings:_,turnservers:b,camDeviceId:j,micDeviceId:N},O&&(window.SHOW_INFO=!0),A&&(window.NETWORK_THROTTLE_SECRET=A),l||(l=randomString({length:8}).toLowerCase(),s.query.roomId=l,window.history.pushState("","",s.toString())),B=new u["default"](window.location.href,!0),U=0,q=Object.keys(B.query);case 31:if(!(U<q.length)){e.next=41;break}W=q[U],e.t0=W,e.next="roomId"===e.t0?36:"simulcast"===e.t0?36:"sharingSimulcast"===e.t0?36:"produce"===e.t0?36:"consume"===e.t0?36:"forceH264"===e.t0?36:"forceVP9"===e.t0?36:"forceTcp"===e.t0?36:"svc"===e.t0?36:"datachannel"===e.t0?36:"info"===e.t0?36:"faceDetection"===e.t0?36:"externalVideo"===e.t0?36:"throttleSecret"===e.t0?36:37;break;case 36:return e.abrupt("break",38);case 37:delete B.query[W];case 38:U++,e.next=31;break;case 41:delete B.hash,V=B.toString(),K=!!m,G=(0,y["default"])(),p.dispatch(P.setRoomUrl(V)),p.dispatch(P.setRoomFaceDetection(M)),p.dispatch(P.setMe({peerId:d,displayName:m,displayNameSet:K,device:G})),z=o({roomId:l,peerId:d,displayName:m,device:G,handler:v,useSimulcast:S,useSharingSimulcast:C,forceTcp:x,produce:T,consume:D,forceH264:k,forceVP9:w,svc:I,datachannel:E,externalVideo:L,media_server_wss:f},F),console.log(z),n.client=R=new h["default"](z),window.CLIENT=R,window.CC=R;case 53:case"end":return e.stop();}},e)})),a.autorun&&this.run()}}).call(this,e("_process"),"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./Logger":1,"./RoomClient":2,"./deviceInfo":4,"./redux/reducers":9,"./redux/stateActions":16,"./utils":18,"@babel/runtime/helpers/asyncToGenerator":20,"@babel/runtime/helpers/classCallCheck":21,"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24,"@babel/runtime/helpers/interopRequireWildcard":25,"@babel/runtime/regenerator":32,_process:71,redux:82,"redux-thunk":81,"url-parse":94,wildemitter:98}],6:[function(e,t,r){(function(t){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,o["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i={};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:i,r=1<arguments.length?arguments[1]:void 0;switch(r.type){case"SET_ROOM_STATE":{var a=r.payload.state;return"closed"===a?{}:e}case"ADD_CONSUMER":{var n=r.payload.consumer;return t.emitter.emit("ADD_CONSUMER",r.payload),s({},e,(0,o["default"])({},n.id,n))}case"REMOVE_CONSUMER":{var d=r.payload.consumerId,c=s({},e);return delete c[d],t.emitter.emit("REMOVE_CONSUMER",r.payload),c}case"SET_CONSUMER_PAUSED":{var p=r.payload,l=p.consumerId,m=p.originator,u=e[l],f;return f="local"===m?s({},u,{locallyPaused:!0}):s({},u,{remotelyPaused:!0}),t.emitter.emit("SET_CONSUMER_PAUSED",r.payload),s({},e,(0,o["default"])({},l,f))}case"SET_CONSUMER_RESUMED":{var g=r.payload,_=g.consumerId,b=g.originator,y=e[_],h;return h="local"===b?s({},y,{locallyPaused:!1}):s({},y,{remotelyPaused:!1}),t.emitter.emit("SET_CONSUMER_RESUMED",r.payload),s({},e,(0,o["default"])({},_,h))}case"SET_CONSUMER_CURRENT_LAYERS":{var P=r.payload,v=P.consumerId,S=P.spatialLayer,R=P.temporalLayer,C=e[v],x=s({},C,{currentSpatialLayer:S,currentTemporalLayer:R});return s({},e,(0,o["default"])({},v,x))}case"SET_CONSUMER_PREFERRED_LAYERS":{var T=r.payload,D=T.consumerId,k=T.spatialLayer,w=T.temporalLayer,I=e[D],E=s({},I,{preferredSpatialLayer:k,preferredTemporalLayer:w});return s({},e,(0,o["default"])({},D,E))}case"SET_CONSUMER_PRIORITY":{var O=r.payload,M=O.consumerId,L=O.priority,A=e[M],j=s({},A,{priority:L});return s({},e,(0,o["default"])({},M,j))}case"SET_CONSUMER_TRACK":{var N=r.payload,F=N.consumerId,B=N.track,U=e[F],q=s({},U,{track:B});return t.emitter.emit("SET_CONSUMER_TRACK",q),s({},e,(0,o["default"])({},F,q))}case"SET_CONSUMER_SCORE":{var W=r.payload,V=W.consumerId,K=W.score,G=e[V];if(!G)return e;var z=s({},G,{score:K});return s({},e,(0,o["default"])({},V,z))}default:return e;}}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24}],7:[function(e,t,r){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,o["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i={};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:i,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":{var r=t.payload.state;return"closed"===r?{}:e}case"ADD_DATA_CONSUMER":{var a=t.payload.dataConsumer;return s({},e,(0,o["default"])({},a.id,a))}case"REMOVE_DATA_CONSUMER":{var n=t.payload.dataConsumerId,d=s({},e);return delete d[n],d}default:return e;}}},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24}],8:[function(e,t,r){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,o["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i={};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:i,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":{var r=t.payload.state;return"closed"===r?{}:e}case"ADD_DATA_PRODUCER":{var a=t.payload.dataProducer;return s({},e,(0,o["default"])({},a.id,a))}case"REMOVE_DATA_PRODUCER":{var n=t.payload.dataProducerId,d=s({},e);return delete d[n],d}default:return e;}}},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24}],9:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var s=e("redux"),n=a(e("./room")),o=a(e("./me")),i=a(e("./producers")),d=a(e("./dataProducers")),c=a(e("./peers")),p=a(e("./consumers")),l=a(e("./dataConsumers")),m=a(e("./notifications")),u=(0,s.combineReducers)({room:n["default"],me:o["default"],producers:i["default"],dataProducers:d["default"],peers:c["default"],consumers:p["default"],dataConsumers:l["default"],notifications:m["default"]});r["default"]=u},{"./consumers":6,"./dataConsumers":7,"./dataProducers":8,"./me":10,"./notifications":11,"./peers":12,"./producers":13,"./room":14,"@babel/runtime/helpers/interopRequireDefault":24,redux:82}],10:[function(e,t,r){(function(t){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,o["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:i,r=1<arguments.length?arguments[1]:void 0;switch(r.type){case"SET_ROOM_STATE":{var a=r.payload.state;return"closed"===a?s({},e,{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):e}case"SET_ME":{var n=r.payload,o=n.peerId,d=n.displayName,c=n.displayNameSet,p=n.device;return t.emitter.emit("SET_ME",r.payload),s({},e,{id:o,displayName:d,displayNameSet:c,device:p})}case"SET_MEDIA_CAPABILITIES":{var l=r.payload,m=l.canSendMic,u=l.canSendWebcam;return s({},e,{canSendMic:m,canSendWebcam:u})}case"SET_CAN_CHANGE_WEBCAM":{var f=r.payload;return t.emitter.emit("SET_CAN_CHANGE_WEBCAM",r.payload),s({},e,{canChangeWebcam:f})}case"SET_WEBCAM_IN_PROGRESS":{var g=r.payload.flag;return t.emitter.emit("SET_WEBCAM_IN_PROGRESS",r.payload),s({},e,{webcamInProgress:g})}case"SET_SHARE_IN_PROGRESS":{var _=r.payload.flag;return t.emitter.emit("SET_SHARE_IN_PROGRESS",_),s({},e,{shareInProgress:_})}case"SET_DISPLAY_NAME":{var b=r.payload.displayName;return b||(b=e.displayName),t.emitter.emit("SET_DISPLAY_NAME",b),s({},e,{displayName:b,displayNameSet:!0})}case"SET_AUDIO_ONLY_STATE":{var y=r.payload.enabled;return s({},e,{audioOnly:y})}case"SET_AUDIO_ONLY_IN_PROGRESS":{var h=r.payload.flag;return s({},e,{audioOnlyInProgress:h})}case"SET_AUDIO_MUTED_STATE":{var P=r.payload.enabled;return s({},e,{audioMuted:P})}case"SET_RESTART_ICE_IN_PROGRESS":{var v=r.payload.flag;return s({},e,{restartIceInProgress:v})}default:return e;}}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24}],11:[function(e,t,r){"use strict";var a=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var s=a(e("@babel/runtime/helpers/toConsumableArray")),n=[];r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:n,t=1<arguments.length?arguments[1]:void 0;switch(t.type){case"ADD_NOTIFICATION":{var r=t.payload.notification;return[].concat((0,s["default"])(e),[r])}case"REMOVE_NOTIFICATION":{var a=t.payload.notificationId;return e.filter(function(e){return e.id!==a})}case"REMOVE_ALL_NOTIFICATIONS":return[];default:return e;}}},{"@babel/runtime/helpers/interopRequireDefault":24,"@babel/runtime/helpers/toConsumableArray":30}],12:[function(e,t,r){(function(t){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,i["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/toConsumableArray")),i=n(e("@babel/runtime/helpers/defineProperty")),d={};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:d,r=1<arguments.length?arguments[1]:void 0;switch(r.type){case"SET_ROOM_STATE":{var a=r.payload.state;return"closed"===a?{}:e}case"ADD_PEER":{var n=r.payload.peer;return t.emitter.emit("peerAdded",n),s({},e,(0,i["default"])({},n.id,n))}case"REMOVE_PEER":{var c=r.payload.peerId,p=s({},e);return delete p[c],t.emitter.emit("peerRemoved",c),p}case"SET_PEER_DISPLAY_NAME":{var l=r.payload,m=l.displayName,u=l.peerId,f=e[u];if(!f)throw new Error("no Peer found");var g=s({},f,{displayName:m});return s({},e,(0,i["default"])({},g.id,g))}case"ADD_CONSUMER":{var _=r.payload,b=_.consumer,y=_.peerId,h=e[y];if(!h)throw new Error("no Peer found for new Consumer");var P=[].concat((0,o["default"])(h.consumers),[b.id]),v=s({},h,{consumers:P});return t.emitter.emit("peerConsumerAdded",v),s({},e,(0,i["default"])({},v.id,v))}case"REMOVE_CONSUMER":{var S=r.payload,R=S.consumerId,C=S.peerId,x=e[C];if(!x)return e;var T=x.consumers.indexOf(R);if(-1===T)throw new Error("Consumer not found");var D=x.consumers.slice();D.splice(T,1);var k=s({},x,{consumers:D});return t.emitter.emit("peerConsumerRemoved",k),s({},e,(0,i["default"])({},k.id,k))}case"ADD_DATA_CONSUMER":{var w=r.payload,I=w.dataConsumer,E=w.peerId;if(!E)return e;var O=e[E];if(!O)throw new Error("no Peer found for new DataConsumer");var M=[].concat((0,o["default"])(O.dataConsumers),[I.id]),L=s({},O,{dataConsumers:M});return t.emitter.emit("ADD_DATA_CONSUMER",L),s({},e,(0,i["default"])({},L.id,L))}case"REMOVE_DATA_CONSUMER":{var A=r.payload,j=A.dataConsumerId,N=A.peerId;if(!N)return e;var F=e[N];if(!F)return e;var B=F.dataConsumers.indexOf(j);if(-1===B)throw new Error("DataConsumer not found");var U=F.dataConsumers.slice();U.splice(B,1);var q=s({},F,{dataConsumers:U});return t.emitter.emit("REMOVE_DATA_CONSUMER",q),s({},e,(0,i["default"])({},q.id,q))}default:return e;}}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24,"@babel/runtime/helpers/toConsumableArray":30}],13:[function(e,t,r){(function(t){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,o["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i={};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:i,r=1<arguments.length?arguments[1]:void 0;switch(r.type){case"SET_ROOM_STATE":{var a=r.payload.state;return"closed"===a?{}:e}case"ADD_PRODUCER":{var n=r.payload.producer;return t.emitter.emit("ADD_PRODUCER",n),s({},e,(0,o["default"])({},n.id,n))}case"REMOVE_PRODUCER":{var d=r.payload.producerId,c=s({},e);return delete c[d],t.emitter.emit("REMOVE_PRODUCER",d),c}case"SET_PRODUCER_PAUSED":{var p=r.payload.producerId,l=e[p],m=s({},l,{paused:!0});return t.emitter.emit("SET_PRODUCER_PAUSED",m),s({},e,(0,o["default"])({},p,m))}case"SET_PRODUCER_RESUMED":{var u=r.payload.producerId,f=e[u],g=s({},f,{paused:!1});return t.emitter.emit("SET_PRODUCER_RESUMED",g),s({},e,(0,o["default"])({},u,g))}case"SET_PRODUCER_TRACK":{var _=r.payload,b=_.producerId,y=_.track,h=e[b],P=s({},h,{track:y});return t.emitter.emit("SET_PRODUCER_TRACK",P),s({},e,(0,o["default"])({},b,P))}case"SET_PRODUCER_SCORE":{var v=r.payload,S=v.producerId,R=v.score,C=e[S];if(!C)return e;var x=s({},C,{score:R});return t.emitter.emit("SET_PRODUCER_SCORE",x),s({},e,(0,o["default"])({},S,x))}default:return e;}}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24}],14:[function(e,t,r){(function(t){"use strict";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function s(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?a(Object(r),!0).forEach(function(t){(0,o["default"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1};r["default"]=function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:i,r=1<arguments.length?arguments[1]:void 0;switch(r.type){case"SET_ROOM_URL":{var a=r.payload.url;return s({},e,{url:a})}case"SET_ROOM_STATE":{var n=r.payload.state;return t.emitter.emit("SET_ROOM_STATE",n),"connected"===n?s({},e,{state:n}):s({},e,{state:n,activeSpeakerId:null,statsPeerId:null})}case"SET_ROOM_ACTIVE_SPEAKER":{var o=r.payload.peerId;return t.emitter.emit("SET_ROOM_ACTIVE_SPEAKER",o),s({},e,{activeSpeakerId:o})}case"SET_ROOM_STATS_PEER_ID":{var d=r.payload.peerId;return e.statsPeerId===d?s({},e,{statsPeerId:null}):s({},e,{statsPeerId:d})}case"SET_FACE_DETECTION":{var c=r.payload;return s({},e,{faceDetection:c})}case"REMOVE_PEER":{var p=r.payload.peerId,l=s({},e);return p&&p===e.activeSpeakerId&&(l.activeSpeakerId=null),p&&p===e.statsPeerId&&(l.statsPeerId=null),l}default:return e;}}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"@babel/runtime/helpers/defineProperty":23,"@babel/runtime/helpers/interopRequireDefault":24}],15:[function(e,t,a){"use strict";var s=e("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(a,"__esModule",{value:!0}),a.notify=void 0;var n=s(e("./stateActions"));a.notify=function(e){var t=e.type,a=void 0===t?"info":t,s=e.text,o=e.title,i=e.timeout;i||("info"===a?i=3e3:"error"===a?i=5e3:void 0);var d={id:r(1e6*Math.random()).toString(),type:a,title:o,text:s,timeout:i};return function(e){e(n.addNotification(d)),setTimeout(function(){e(n.removeNotification(d.id))},i)}}},{"./stateActions":16,"@babel/runtime/helpers/interopRequireWildcard":25}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.removeAllNotifications=r.removeNotification=r.addNotification=r.removeDataConsumer=r.addDataConsumer=r.setConsumerScore=r.setConsumerTrack=r.setConsumerPriority=r.setConsumerPreferredLayers=r.setConsumerCurrentLayers=r.setConsumerResumed=r.setConsumerPaused=r.removeConsumer=r.addConsumer=r.setPeerDisplayName=r.removePeer=r.addPeer=r.setShareInProgress=r.setWebcamInProgress=r.removeDataProducer=r.addDataProducer=r.setProducerScore=r.setProducerTrack=r.setProducerResumed=r.setProducerPaused=r.removeProducer=r.addProducer=r.setRestartIceInProgress=r.setAudioMutedState=r.setAudioOnlyInProgress=r.setAudioOnlyState=r.setDisplayName=r.setCanChangeWebcam=r.setMediaCapabilities=r.setMe=r.setRoomFaceDetection=r.setRoomStatsPeerId=r.setRoomActiveSpeaker=r.setRoomState=r.setRoomUrl=void 0;r.setRoomUrl=function(e){return{type:"SET_ROOM_URL",payload:{url:e}}};r.setRoomState=function(e){return{type:"SET_ROOM_STATE",payload:{state:e}}};r.setRoomActiveSpeaker=function(e){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:e}}};r.setRoomStatsPeerId=function(e){return{type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:e}}};r.setRoomFaceDetection=function(e){return{type:"SET_FACE_DETECTION",payload:e}};r.setMe=function(e){var t=e.peerId,r=e.displayName,a=e.displayNameSet,s=e.device;return{type:"SET_ME",payload:{peerId:t,displayName:r,displayNameSet:a,device:s}}};r.setMediaCapabilities=function(e){var t=e.canSendMic,r=e.canSendWebcam;return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:t,canSendWebcam:r}}};r.setCanChangeWebcam=function(e){return{type:"SET_CAN_CHANGE_WEBCAM",payload:e}};r.setDisplayName=function(e){return{type:"SET_DISPLAY_NAME",payload:{displayName:e}}};r.setAudioOnlyState=function(e){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:e}}};r.setAudioOnlyInProgress=function(e){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:e}}};r.setAudioMutedState=function(e){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:e}}};r.setRestartIceInProgress=function(e){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:e}}};r.addProducer=function(e){return{type:"ADD_PRODUCER",payload:{producer:e}}};r.removeProducer=function(e){return{type:"REMOVE_PRODUCER",payload:{producerId:e}}};r.setProducerPaused=function(e){return{type:"SET_PRODUCER_PAUSED",payload:{producerId:e}}};r.setProducerResumed=function(e){return{type:"SET_PRODUCER_RESUMED",payload:{producerId:e}}};r.setProducerTrack=function(e,t){return{type:"SET_PRODUCER_TRACK",payload:{producerId:e,track:t}}};r.setProducerScore=function(e,t){return{type:"SET_PRODUCER_SCORE",payload:{producerId:e,score:t}}};r.addDataProducer=function(e){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:e}}};r.removeDataProducer=function(e){return{type:"REMOVE_DATA_PRODUCER",payload:{dataProducerId:e}}};r.setWebcamInProgress=function(e){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:e}}};r.setShareInProgress=function(e){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:e}}};r.addPeer=function(e){return{type:"ADD_PEER",payload:{peer:e}}};r.removePeer=function(e){return{type:"REMOVE_PEER",payload:{peerId:e}}};r.setPeerDisplayName=function(e,t){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:e,peerId:t}}};r.addConsumer=function(e,t){return{type:"ADD_CONSUMER",payload:{consumer:e,peerId:t}}};r.removeConsumer=function(e,t){return{type:"REMOVE_CONSUMER",payload:{consumerId:e,peerId:t}}};r.setConsumerPaused=function(e,t){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:e,originator:t}}};r.setConsumerResumed=function(e,t){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:e,originator:t}}};r.setConsumerCurrentLayers=function(e,t,r){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}};r.setConsumerPreferredLayers=function(e,t,r){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}};r.setConsumerPriority=function(e,t){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:e,priority:t}}};r.setConsumerTrack=function(e,t){return{type:"SET_CONSUMER_TRACK",payload:{consumerId:e,track:t}}};r.setConsumerScore=function(e,t){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:e,score:t}}};r.addDataConsumer=function(e,t){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:e,peerId:t}}};r.removeDataConsumer=function(e,t){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:e,peerId:t}}};r.addNotification=function(e){return{type:"ADD_NOTIFICATION",payload:{notification:e}}};r.removeNotification=function(e){return{type:"REMOVE_NOTIFICATION",payload:{notificationId:e}}};r.removeAllNotifications=function(){return{type:"REMOVE_ALL_NOTIFICATIONS"}}},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProtooUrl=function(e){var t=e.media_server_wss,r=e.roomId,a=e.peerId,s=e.forceH264,n=e.forceVP9;t||console.error("config.media_server_wss don't set.");var o="".concat(t,"/?roomId=").concat(r,"&peerId=").concat(a);return s?o="".concat(o,"&forceH264=true"):n&&(o="".concat(o,"&forceVP9=true")),o}},{}],18:[function(e,t,r){"use strict";function a(){return!!n.offsetParent}function s(){return!n.offsetParent}Object.defineProperty(r,"__esModule",{value:!0}),r.initialize=function(){return n=document.getElementById("mediasoup-demo-app-media-query-detector"),Promise.resolve()},r.isDesktop=a,r.isMobile=s;var n},{}],19:[function(e,t){t.exports=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},{}],20:[function(e,t){function r(e,t,r,a,s,n,o){try{var i=e[n](o),d=i.value}catch(e){return void r(e)}i.done?t(d):Promise.resolve(d).then(a,s)}t.exports=function(e){return function(){var t=this,a=arguments;return new Promise(function(s,n){function o(e){r(d,s,n,o,i,"next",e)}function i(e){r(d,s,n,o,i,"throw",e)}var d=e.apply(t,a);o(void 0)})}}},{}],21:[function(e,t){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],22:[function(e,t){function r(e,t){for(var r=0,a;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}t.exports=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}},{}],23:[function(e,t){function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.exports=r},{}],24:[function(e,t){t.exports=function(e){return e&&e.__esModule?e:{default:e}}},{}],25:[function(e,t){function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function a(e){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(a,o,i):a[o]=e[o]}return a["default"]=e,t&&t.set(e,a),a}var s=e("../helpers/typeof");t.exports=a},{"../helpers/typeof":31}],26:[function(e,t){function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}t.exports=r},{}],27:[function(e,t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},{}],28:[function(e,t){var r=e("./objectWithoutPropertiesLoose");t.exports=function(e,t){if(null==e)return{};var a=r(e,t),s,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)s=o[n],!(0<=t.indexOf(s))&&Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}},{"./objectWithoutPropertiesLoose":29}],29:[function(e,t){t.exports=function(e,t){if(null==e)return{};var r={},a=Object.keys(e),s,n;for(n=0;n<a.length;n++)s=a[n],0<=t.indexOf(s)||(r[s]=e[s]);return r}},{}],30:[function(e,t){var r=e("./arrayWithoutHoles"),a=e("./iterableToArray"),s=e("./nonIterableSpread");t.exports=function(e){return r(e)||a(e)||s()}},{"./arrayWithoutHoles":19,"./iterableToArray":26,"./nonIterableSpread":27}],31:[function(e,t){function r(e){return t.exports="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?r=function(e){return typeof e}:r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r},{}],32:[function(e,t){t.exports=e("regenerator-runtime")},{"regenerator-runtime":83}],33:[function(e,t){t.exports=class{constructor({ClosedErrorClass:e=Error}={}){this._closed=!1,this._tasks=[],this._closedErrorClass=e}close(){this._closed=!0}async push(e){if("function"!=typeof e)throw new TypeError("given task is not a function");return new Promise((t,r)=>{e._resolve=t,e._reject=r,this._tasks.push(e),1===this._tasks.length&&this._next()})}async _next(){const e=this._tasks[0];e&&(await this._runTask(e),this._tasks.shift(),this._next())}async _runTask(e){if(this._closed)return void e._reject(new this._closedErrorClass("AwaitQueue closed"));try{const t=await e();if(this._closed)return void e._reject(new this._closedErrorClass("AwaitQueue closed"));e._resolve(t)}catch(t){if(this._closed)return void e._reject(new this._closedErrorClass("AwaitQueue closed"));e._reject(t)}}}},{}],34:[function(e,r,a){!function(n,e){"object"==typeof a&&"object"==typeof r?r.exports=e():"function"==typeof s&&s.amd?s([],e):"object"==typeof a?a.bowser=e():n.bowser=e()}(this,function(){return function(a){function s(t){if(e[t])return e[t].exports;var r=e[t]={i:t,l:!1,exports:{}};return a[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}var e={};return s.m=a,s.c=e,s.d=function(r,e,t){s.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(r,a){if(1&a&&(r=s(r)),8&a)return r;if(4&a&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&a&&"string"!=typeof r)for(var n in r)s.d(t,n,function(e){return r[e]}.bind(null,n));return t},s.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(e,"a",e),e},s.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},s.p="",s(s.s=90)}({17:function(a,e,s){"use strict";e.__esModule=!0,e.default=void 0;var r=s(18),n=function(){function d(){}return d.getFirstMatch=function(a,e){var t=e.match(a);return t&&0<t.length&&t[1]||""},d.getSecondMatch=function(a,e){var t=e.match(a);return t&&1<t.length&&t[2]||""},d.matchAndReturnConst=function(a,e,t){if(a.test(e))return t},d.getWindowsVersionName=function(t){return"NT"===t?"NT":"XP"===t?"XP":"NT 5.0"===t?"2000":"NT 5.1"===t?"XP":"NT 5.2"===t?"2003":"NT 6.0"===t?"Vista":"NT 6.1"===t?"7":"NT 6.2"===t?"8":"NT 6.3"===t?"8.1":"NT 10.0"===t?"10":void 0},d.getMacOSVersionName=function(r){var e=r.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:}},d.getAndroidVersionName=function(r){var e=r.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),!(1===e[0]&&5>e[1]))return 1===e[0]&&6>e[1]?"Cupcake":1===e[0]&&6<=e[1]?"Donut":2===e[0]&&2>e[1]?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&2<e[1]?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&1>e[1]?"Ice Cream Sandwich":4===e[0]&&4>e[1]?"Jelly Bean":4===e[0]&&4<=e[1]?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},d.getVersionPrecision=function(t){return t.split(".").length},d.compareVersions=function(e,c,r){void 0===r&&(r=!1);var p=d.getVersionPrecision(e),i=d.getVersionPrecision(c),s=Math.max(p,i),l=0,m=d.map([e,c],function(e){var t=s-d.getVersionPrecision(e),r=e+Array(t+1).join(".0");return d.map(r.split("."),function(t){return Array(20-t.length).join("0")+t}).reverse()});for(r&&(l=s-t(p,i)),s-=1;s>=l;){if(m[0][s]>m[1][s])return 1;if(m[0][s]===m[1][s]){if(s===l)return 0;s-=1}else if(m[0][s]<m[1][s])return-1}},d.map=function(a,e){var t=[],s;if(Array.prototype.map)return Array.prototype.map.call(a,e);for(s=0;s<a.length;s+=1)t.push(e(a[s]));return t},d.find=function(a,e){var t,s;if(Array.prototype.find)return Array.prototype.find.call(a,e);for(t=0,s=a.length;t<s;t+=1){var o=a[t];if(e(o,t))return o}},d.assign=function(d){for(var c=d,e=arguments.length,n=Array(1<e?e-1:0),s=1,i,p;s<e;s++)n[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[d].concat(n));var l=function(){var r=n[i];"object"==typeof r&&null!==r&&Object.keys(r).forEach(function(e){c[e]=r[e]})};for(i=0,p=n.length;i<p;i+=1)l();return d},d.getBrowserAlias=function(t){return r.BROWSER_ALIASES_MAP[t]},d.getBrowserTypeByAlias=function(t){return r.BROWSER_MAP[t]||""},d}();e.default=n,a.exports=e.default},18:function(r,e){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(d,e,t){"use strict";function c(a,e){for(var t=0,s;t<e.length;t++)s=e[t],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,s.key,s)}e.__esModule=!0,e.default=void 0;var r=(a=t(91))&&a.__esModule?a:{default:a},o=t(18),s=function(){function a(){}var e,s,i;return a.getParser=function(a,e){if(void 0===e&&(e=!1),"string"!=typeof a)throw new Error("UserAgent should be a string");return new r.default(a,e)},a.parse=function(t){return new r.default(t).getResult()},e=a,i=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(s=null)&&c(e.prototype,s),i&&c(e,i),a}(),a;e.default=s,d.exports=e.default},91:function(c,e,t){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.default=void 0;var p=r(t(92)),n=r(t(93)),i=r(t(94)),s=r(t(95)),m=r(t(17)),a=function(){function r(r,e){if(void 0===e&&(e=!1),null==r||""===r)throw new Error("UserAgent parameter can't be empty");this._ua=r,this.parsedResult={},!0!==e&&this.parse()}var e=r.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var r=this;this.parsedResult.browser={};var e=m.default.find(p.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?(this.getBrowser().name+"").toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var r=this;this.parsedResult.os={};var e=m.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(r){var e=this.getOS().name;return r?(e+"").toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(r){void 0===r&&(r=!1);var a=this.getPlatform().type;return r?(a+"").toLowerCase()||"":a||""},e.parsePlatform=function(){var r=this;this.parsedResult.platform={};var e=m.default.find(i.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?(this.getEngine().name+"").toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var r=this;this.parsedResult.engine={};var e=m.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(r);if(e.test instanceof Array)return e.test.some(function(e){return r.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return m.default.assign({},this.parsedResult)},e.satisfies=function(a){var p=this,e={},r=0,g={},i=0;if(Object.keys(a).forEach(function(s){var t=a[s];"string"==typeof t?(g[s]=t,i+=1):"object"==typeof t&&(e[s]=t,r+=1)}),0<r){var t=Object.keys(e),o=m.default.find(t,function(t){return p.isOS(t)});if(o){var u=this.satisfies(e[o]);if(void 0!==u)return u}var d=m.default.find(t,function(t){return p.isPlatform(t)});if(d){var c=this.satisfies(e[d]);if(void 0!==c)return c}}if(0<i){var f=Object.keys(g),l=m.default.find(f,function(t){return p.isBrowser(t,!0)});if(void 0!==l)return this.compareVersion(g[l])}},e.isBrowser=function(a,e){void 0===e&&(e=!1);var s=this.getBrowserName().toLowerCase(),r=a.toLowerCase(),o=m.default.getBrowserTypeByAlias(r);return e&&o&&(r=o.toLowerCase()),r===s},e.compareVersion=function(a){var e=[0],s=a,o=!1,d=this.getBrowserVersion();if("string"==typeof d)return">"===a[0]||"<"===a[0]?(s=a.substr(1),"="===a[1]?(o=!0,s=a.substr(2)):e=[],">"===a[0]?e.push(1):e.push(-1)):"="===a[0]?s=a.substr(1):"~"===a[0]&&(o=!0,s=a.substr(1)),-1<e.indexOf(m.default.compareVersions(d,s,o))},e.isOS=function(t){return this.getOSName(!0)===(t+"").toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===(t+"").toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===(t+"").toLowerCase()},e.is=function(t){return this.isBrowser(t)||this.isOS(t)||this.isPlatform(t)},e.some=function(r){var a=this;return void 0===r&&(r=[]),r.some(function(t){return a.is(t)})},r}();e.default=a,c.exports=e.default},92:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=/version\/(\d+(\.?_?\d+)+)/i,r=[{test:[/googlebot/i],describe:function(a){var e={name:"Googlebot"},t=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/opera/i],describe:function(a){var e={name:"Opera"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe:function(a){var e={name:"Opera"},t=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe:function(a){var e={name:"Samsung Internet for Android"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/Whale/i],describe:function(a){var e={name:"NAVER Whale Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe:function(a){var e={name:"MZ Browser"},t=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/focus/i],describe:function(a){var e={name:"Focus"},t=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/swing/i],describe:function(a){var e={name:"Swing"},t=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/coast/i],describe:function(a){var e={name:"Opera Coast"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe:function(a){var e={name:"Yandex Browser"},t=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe:function(a){var e={name:"UC Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe:function(a){var e={name:"Maxthon"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/epiphany/i],describe:function(a){var e={name:"Epiphany"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/puffin/i],describe:function(a){var e={name:"Puffin"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe:function(a){var e={name:"Sleipnir"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe:function(a){var e={name:"K-Meleon"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe:function(a){var e={name:"WeChat"},t=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe:function(a){var e={name:/qqbrowserlite/i.test(a)?"QQ Browser Lite":"QQ Browser"},t=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe:function(a){var e={name:"Internet Explorer"},t=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe:function(a){var e={name:"Microsoft Edge"},t=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe:function(a){var e={name:"Microsoft Edge"},t=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe:function(a){var e={name:"Vivaldi"},t=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe:function(a){var e={name:"SeaMonkey"},t=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/sailfish/i],describe:function(a){var e={name:"Sailfish"},t=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,a);return t&&(e.version=t),e}},{test:[/silk/i],describe:function(a){var e={name:"Amazon Silk"},t=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/phantom/i],describe:function(a){var e={name:"PhantomJS"},t=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe:function(a){var e={name:"SlimerJS"},t=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var e={name:"BlackBerry"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var e={name:"WebOS Browser"},t=d.default.getFirstMatch(i,a)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/bada/i],describe:function(a){var e={name:"Bada"},t=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/tizen/i],describe:function(a){var e={name:"Tizen"},t=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe:function(a){var e={name:"QupZilla"},t=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(a){var e={name:"Firefox"},t=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/electron/i],describe:function(a){var e={name:"Electron"},t=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/chromium/i],describe:function(a){var e={name:"Chromium"},t=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,a)||d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe:function(a){var e={name:"Chrome"},t=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/GSA/i],describe:function(a){var e={name:"Google Search"},t=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(a){var e=!a.test(/like android/i),t=a.test(/android/i);return e&&t},describe:function(a){var e={name:"Android Browser"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe:function(a){var e={name:"PlayStation 4"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe:function(a){var e={name:"Safari"},t=d.default.getFirstMatch(i,a);return t&&(e.version=t),e}},{test:[/.*/i],describe:function(r){var e=-1===r.search("\\(")?/^(.*)\/(.*) /:/^(.*)\/(.*)[ \t]\((.*)/;return{name:d.default.getFirstMatch(e,r),version:d.default.getSecondMatch(e,r)}}}],s;e.default=r,a.exports=e.default},93:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=t(18),r=[{test:[/Roku\/DVP/],describe:function(r){var e=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,r);return{name:i.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(r){var e=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(a){var e=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,a),t=d.default.getWindowsVersionName(e);return{name:i.OS_MAP.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(r){var e=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,r);return{name:i.OS_MAP.iOS,version:e}}},{test:[/macintosh/i],describe:function(a){var e=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,a).replace(/[_\s]/g,"."),t=d.default.getMacOSVersionName(e),r={name:i.OS_MAP.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(r){var e=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,r).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:e}}},{test:function(a){var e=!a.test(/like android/i),t=a.test(/android/i);return e&&t},describe:function(a){var e=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,a),t=d.default.getAndroidVersionName(e),r={name:i.OS_MAP.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var e=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,a),t={name:i.OS_MAP.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(r){var e=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,r)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,r)||d.default.getFirstMatch(/\bbb(\d+)/i,r);return{name:i.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(r){var e=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(r){var e=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(r){var e=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,r);return{name:i.OS_MAP.PlayStation4,version:e}}}],s;e.default=r,a.exports=e.default},94:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=t(18),r=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(a){var e=d.default.getFirstMatch(/(can-l01)/i,a)&&"Nova",t={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(a){var e=a.test(/ipod|iphone/i),t=a.test(/like (ipod|iphone)/i);return e&&!t},describe:function(r){var e=d.default.getFirstMatch(/(ipod|iphone)/i,r);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(r){var e=+(r.getOSVersion()+"").split(".")[0];return"android"===r.getOSName(!0)&&3<=e},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}],s;e.default=r,a.exports=e.default},95:function(a,e,t){"use strict";e.__esModule=!0,e.default=void 0;var d=(s=t(17))&&s.__esModule?s:{default:s},i=t(18),r=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(r){if(/\sedg\//i.test(r))return{name:i.ENGINE_MAP.Blink};var e=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,r);return{name:i.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(a){var e={name:i.ENGINE_MAP.Trident},t=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(t){return t.test(/presto/i)},describe:function(a){var e={name:i.ENGINE_MAP.Presto},t=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:function(a){var e=a.test(/gecko/i),t=a.test(/like gecko/i);return e&&!t},describe:function(a){var e={name:i.ENGINE_MAP.Gecko},t=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(a){var e={name:i.ENGINE_MAP.WebKit},t=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,a);return t&&(e.version=t),e}}],s;e.default=r,a.exports=e.default}})})},{}],35:[function(e,t){function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=h(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function a(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function s(e,t,r){if(t)e.call(r);else for(var a=e.length,s=b(e,a),n=0;n<a;++n)s[n].call(r)}function n(e,t,r,a){if(t)e.call(r,a);else for(var s=e.length,n=b(e,s),o=0;o<s;++o)n[o].call(r,a)}function d(e,t,r,a,s){if(t)e.call(r,a,s);else for(var n=e.length,o=b(e,n),d=0;d<n;++d)o[d].call(r,a,s)}function c(e,t,r,a,s,n){if(t)e.call(r,a,s,n);else for(var o=e.length,d=b(e,o),c=0;c<o;++c)d[c].call(r,a,s,n)}function p(e,t,r,a){if(t)e.apply(r,a);else for(var s=e.length,n=b(e,s),o=0;o<s;++o)n[o].apply(r,a)}function l(e,t,r,s){var n,o,i;if("function"!=typeof r)throw new TypeError("\"listener\" argument must be a function");if(o=e._events,o?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),i=o[t]):(o=e._events=h(null),e._eventsCount=0),!i)i=o[t]=r,++e._eventsCount;else if("function"==typeof i?i=o[t]=s?[r,i]:[i,r]:s?i.unshift(r):i.push(r),!i.warned&&(n=a(e),n&&0<n&&i.length>n)){i.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+i.length+" \""+(t+"\" listeners added. Use emitter.setMaxListeners() to increase limit."));d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=i.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",d.name,d.message)}return e}function m(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e);}}function u(e,t,r){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=v.call(m,a);return s.listener=r,a.wrapFn=s,s}function f(e,t,r){var a=e._events;if(!a)return[];var s=a[t];return s?"function"==typeof s?r?[s.listener||s]:[s]:r?y(s):b(s,s.length):[]}function g(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function _(e,t){for(var r=t,a=r+1,s=e.length;a<s;r+=1,a+=1)e[r]=e[a];e.pop()}function b(e,t){for(var r=Array(t),a=0;a<t;++a)r[a]=e[a];return r}function y(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}var h=Object.create||function(e){var t=function(){};return t.prototype=e,new t},P=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},v=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var S=10,R;try{var C={};Object.defineProperty&&Object.defineProperty(C,"x",{value:0}),R=0===C.x}catch(e){R=!1}R?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(e){if("number"!=typeof e||0>e||e!==e)throw new TypeError("\"defaultMaxListeners\" must be a positive number");S=e}}):r.defaultMaxListeners=S,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||isNaN(e))throw new TypeError("\"n\" argument must be a positive number");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return a(this)},r.prototype.emit=function(e){var t="error"===e,r,a,o,l,m,u;if(u=this._events,u)t=t&&null==u.error;else if(!t)return!1;if(t){if(1<arguments.length&&(r=arguments[1]),r instanceof Error)throw r;else{var f=new Error("Unhandled \"error\" event. ("+r+")");throw f.context=r,f}return!1}if(a=u[e],!a)return!1;var g="function"==typeof a;switch(o=arguments.length,o){case 1:s(a,g,this);break;case 2:n(a,g,this,arguments[1]);break;case 3:d(a,g,this,arguments[1],arguments[2]);break;case 4:c(a,g,this,arguments[1],arguments[2],arguments[3]);break;default:for(l=Array(o-1),m=1;m<o;m++)l[m-1]=arguments[m];p(a,g,this,l);}return!0},r.prototype.addListener=function(e,t){return l(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return l(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");return this.on(e,u(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");return this.prependListener(e,u(this,e,t)),this},r.prototype.removeListener=function(e,t){var r,a,s,n,o;if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");if(a=this._events,!a)return this;if(r=a[e],!r)return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=h(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,n=r.length-1;0<=n;n--)if(r[n]===t||r[n].listener===t){o=r[n].listener,s=n;break}if(0>s)return this;0===s?r.shift():_(r,s),1===r.length&&(a[e]=r[0]),a.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.removeAllListeners=function(e){var t,r,a;if(r=this._events,!r)return this;if(!r.removeListener)return 0===arguments.length?(this._events=h(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=h(null):delete r[e]),this;if(0===arguments.length){var s=P(r),n;for(a=0;a<s.length;++a)n=s[a],"removeListener"===n||this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=h(null),this._eventsCount=0,this}if(t=r[e],"function"==typeof t)this.removeListener(e,t);else if(t)for(a=t.length-1;0<=a;a--)this.removeListener(e,t[a]);return this},r.prototype.listeners=function(e){return f(this,e,!0)},r.prototype.rawListeners=function(e){return f(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},r.prototype.listenerCount=g,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],36:[function(e,t,r){(function(a){function s(){let e;try{e=r.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof a&&"env"in a&&(e=a.env.DEBUG),e}r.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let a=0,s=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"===e||(a++,"%c"===e&&(s=a))}),e.splice(s,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=s,r.useColors=function(){return!!("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(r);const{formatters:n}=t.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":37,_process:71}],37:[function(t,r){r.exports=function(r){function a(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return s.colors[e(r)%s.colors.length]}function s(e){function t(...e){if(!t.enabled)return;const a=t,n=+new Date,o=n-(r||n);a.diff=o,a.prev=r,a.curr=n,r=n,e[0]=s.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,r)=>{if("%%"===t)return t;i++;const n=s.formatters[r];if("function"==typeof n){const r=e[i];t=n.call(a,r),e.splice(i,1),i--}return t}),s.formatArgs.call(a,e);const d=a.log||s.log;d.apply(a,e)}let r;return t.namespace=e,t.enabled=s.enabled(e),t.useColors=s.useColors(),t.color=a(e),t.destroy=n,t.extend=o,"function"==typeof s.init&&s.init(t),s.instances.push(t),t}function n(){const e=s.instances.indexOf(this);return-1!==e&&(s.instances.splice(e,1),!0)}function o(e,t){const r=s(this.namespace+("undefined"==typeof t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return s.debug=s,s.default=s,s.coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){const e=[...s.names.map(i),...s.skips.map(i).map(e=>"-"+e)].join(",");return s.enable(""),e},s.enable=function(e){s.save(e),s.names=[],s.skips=[];let t;const r=("string"==typeof e?e:"").split(/[\s,]+/),a=r.length;for(t=0;t<a;t++)r[t]&&(e=r[t].replace(/\*/g,".*?"),"-"===e[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")));for(t=0;t<s.instances.length;t++){const e=s.instances[t];e.enabled=s.enabled(e.namespace)}},s.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=s.skips.length;t<r;t++)if(s.skips[t].test(e))return!1;for(t=0,r=s.names.length;t<r;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=t("ms"),Object.keys(r).forEach(e=>{s[e]=r[e]}),s.instances=[],s.names=[],s.skips=[],s.formatters={},s.selectColor=a,s.enable(s.load()),s}},{ms:70}],38:[function(e,t,r){function a(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function s(e,t){return e===u?t!==f&&t!==u:t===u?e!==f:e<t}function n(e,t){return s(e,t)?e:t}function o(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}const i=e("debug")("h264-profile-level-id");i.log=console.info.bind(console);const d=1,c=2,p=3,l=4,m=5;r.ProfileConstrainedBaseline=1,r.ProfileBaseline=c,r.ProfileMain=p,r.ProfileConstrainedHigh=l,r.ProfileHigh=m;const u=0,f=10,g=11,_=12,b=13,y=20,h=21,P=22,v=30,S=31,R=32,C=40,x=41,T=42,D=50,k=51,w=52;r.Level1_b=0,r.Level1=f,r.Level1_1=g,r.Level1_2=_,r.Level1_3=b,r.Level2=y,r.Level2_1=h,r.Level2_2=P,r.Level3=v,r.Level3_1=S,r.Level3_2=R,r.Level4=C,r.Level4_1=x,r.Level4_2=T,r.Level5=D,r.Level5_1=k,r.Level5_2=w;class I{constructor(e,t){this.profile=e,this.level=t}}r.ProfileLevelId=I;const E=new I(1,S);class O{constructor(e){this._mask=~a("x",e),this._maskedValue=a("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class M{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const L=[new M(66,new O("x1xx0000"),1),new M(77,new O("1xxx0000"),1),new M(88,new O("11xx0000"),1),new M(66,new O("x0xx0000"),c),new M(88,new O("10xx0000"),c),new M(77,new O("0x0x0000"),p),new M(100,new O("00000000"),m),new M(100,new O("00001100"),l)];r.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,a=255&t>>8;let s;switch(r){case g:{s=0==(a&16)?g:u;break}case f:case _:case b:case y:case h:case P:case v:case S:case R:case C:case x:case T:case D:case k:case w:{s=r;break}default:return i("parseProfileLevelId() | unrecognized level_idc:%s",r),null;}for(const r of L)if((255&t>>16)===r.profile_idc&&r.profile_iop.isMatch(a))return new I(r.profile,s);return i("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},r.profileLevelIdToString=function(e){if(e.level==u)switch(e.profile){case d:return"42f00b";case c:return"42100b";case p:return"4d100b";default:return i("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null;}let t;switch(e.profile){case d:{t="42e0";break}case c:{t="4200";break}case p:{t="4d00";break}case l:{t="640c";break}case m:{t="6400";break}default:return i("profileLevelIdToString() | unrecognized profile:%s",e.profile),null;}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},r.parseSdpProfileLevelId=function(e={}){const t=e["profile-level-id"];return t?r.parseProfileLevelId(t):E},r.isSameProfile=function(e={},t={}){const a=r.parseSdpProfileLevelId(e),s=r.parseSdpProfileLevelId(t);return!!(a&&s&&a.profile===s.profile)},r.generateProfileLevelIdForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"])return i("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const a=r.parseSdpProfileLevelId(e),s=r.parseSdpProfileLevelId(t);if(!a)throw new TypeError("invalid local_profile_level_id");if(!s)throw new TypeError("invalid remote_profile_level_id");if(a.profile!==s.profile)throw new TypeError("H264 Profile mismatch");const d=o(e)&&o(t),c=a.level,p=s.level,l=n(c,p),m=d?c:l;return i("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",a.profile,m),r.profileLevelIdToString(new I(a.profile,m))}},{debug:36}],39:[function(e,t,r){/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */(function(e){var a;if("function"==typeof s&&s.amd&&(s(e),a=!0),"object"==typeof r&&(t.exports=e(),a=!0),!a){var n=window.Cookies,o=window.Cookies=e();o.noConflict=function(){return window.Cookies=n,o}}})(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var a in r)t[a]=r[a]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function r(a){function s(){}function n(t,r,n){if("undefined"!=typeof document){n=e({path:"/"},s.defaults,n),"number"==typeof n.expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(t){}r=a.write?a.write(r,t):encodeURIComponent(r+"").replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(t+"").replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i="";for(var d in n)n[d]&&(i+="; "+d,!0!==n[d])&&(i+="="+n[d].split(";")[0]);return document.cookie=t+"="+r+i}}function o(e,r){if("undefined"!=typeof document){for(var s={},n=document.cookie?document.cookie.split("; "):[],o=0;o<n.length;o++){var d=n[o].split("="),c=d.slice(1).join("=");r||"\""!==c.charAt(0)||(c=c.slice(1,-1));try{var p=t(d[0]);if(c=(a.read||a)(c,p)||t(c),r)try{c=JSON.parse(c)}catch(t){}if(s[p]=c,e===p)break}catch(t){}}return e?s[e]:s}}return s.set=n,s.get=function(e){return o(e,!1)},s.getJSON=function(e){return o(e,!0)},s.remove=function(t,r){n(t,"",e(r,{expires:-1}))},s.defaults={},s.withConverter=r,s}return r(function(){})})},{}],40:[function(e,t){const r=e("./Logger"),a=e("./EnhancedEventEmitter"),{InvalidStateError:s}=e("./errors"),n=new r("Consumer");class o extends a{constructor({id:e,localId:t,producerId:r,track:a,rtpParameters:s,appData:o}){super(n),this._id=e,this._localId=t,this._producerId=r,this._closed=!1,this._track=a,this._rtpParameters=s,this._paused=!a.enabled,this._appData=o,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(){this._closed||(n.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"))}transportClosed(){this._closed||(n.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"))}async getStats(){if(this._closed)throw new s("closed");return this.safeEmitAsPromise("@getstats")}pause(){return n.debug("pause()"),this._closed?void n.error("pause() | Consumer closed"):void(this._paused=!0,this._track.enabled=!1)}resume(){return n.debug("resume()"),this._closed?void n.error("resume() | Consumer closed"):void(this._paused=!1,this._track.enabled=!0)}_onTrackEnded(){n.debug("track \"ended\" event"),this.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}t.exports=o},{"./EnhancedEventEmitter":44,"./Logger":45,"./errors":49}],41:[function(e,t){const r=e("./Logger"),a=e("./EnhancedEventEmitter"),s=new r("DataConsumer");class n extends a{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:a,appData:n}){super(s),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._closed=!1,this._sctpStreamParameters=a,this._appData=n,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"))}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug("DataChannel \"open\" event"),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):s.error("DataChannel \"error\" event: %o",t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn("DataChannel \"close\" event"),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}t.exports=n},{"./EnhancedEventEmitter":44,"./Logger":45}],42:[function(e,t){const r=e("./Logger"),a=e("./EnhancedEventEmitter"),{InvalidStateError:s}=e("./errors"),n=new r("DataProducer");class o extends a{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:a}){super(n),this._id=e,this._dataChannel=t,this._closed=!1,this._sctpStreamParameters=r,this._appData=a,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(){this._closed||(n.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"))}transportClosed(){this._closed||(n.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"))}send(e){if(n.debug("send()"),this._closed)throw new s("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(n.debug("DataChannel \"open\" event"),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?n.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):n.error("DataChannel \"error\" event: %o",t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(n.warn("DataChannel \"close\" event"),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||n.warn("DataChannel \"message\" event in a DataProducer, message discarded")}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}t.exports=o},{"./EnhancedEventEmitter":44,"./Logger":45,"./errors":49}],43:[function(e,t){const r=e("./Logger"),{UnsupportedError:a,InvalidStateError:s}=e("./errors"),n=e("./detectDevice"),o=e("./ortc"),i=e("./Transport"),d=e("./handlers/Chrome74"),c=e("./handlers/Chrome70"),p=e("./handlers/Chrome67"),l=e("./handlers/Chrome55"),m=e("./handlers/Firefox60"),u=e("./handlers/Safari12"),f=e("./handlers/Safari11"),g=e("./handlers/Edge11"),_=e("./handlers/ReactNative"),b=new r("Device");class y{constructor({Handler:e}={}){if("string"==typeof e)switch(e){case"Chrome74":e=d;break;case"Chrome70":e=c;break;case"Chrome67":e=p;break;case"Chrome55":e=l;break;case"Firefox60":e=m;break;case"Safari12":e=u;break;case"Safari11":e=f;break;case"Edge11":e=g;break;case"ReactNative":e=_;break;default:throw new TypeError(`unknown Handler "${e}"`);}if(this._Handler=e||n(),!this._Handler)throw new a("device not supported");b.debug("constructor() [Handler:%s]",this._Handler.name),this._loaded=!1,this._extendedRtpCapabilities=null,this._recvRtpCapabilities=null,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=null}get handlerName(){return this._Handler.name}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new s("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new s("not loaded");return this._sctpCapabilities}async load({routerRtpCapabilities:e}={}){if(b.debug("load() [routerRtpCapabilities:%o]",e),this._loaded)throw new s("already loaded");else if("object"!=typeof e)throw new TypeError("missing routerRtpCapabilities");const t=await this._Handler.getNativeRtpCapabilities();b.debug("load() | got native RTP capabilities:%o",t),this._extendedRtpCapabilities=o.getExtendedRtpCapabilities(t,e),b.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=o.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=o.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=o.getRecvRtpCapabilities(this._extendedRtpCapabilities),b.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await this._Handler.getNativeSctpCapabilities(),b.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),b.debug("load() succeeded"),this._loaded=!0}canProduce(e){if(!this._loaded)throw new s("not loaded");else if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:i,appData:d={}}={}){return b.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:i,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:i,appData:d={}}={}){return b.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:i,appData:d})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:o,iceServers:d,iceTransportPolicy:c,proprietaryConstraints:p,appData:l={}}){if(b.debug("createTransport()"),!this._loaded)throw new s("not loaded");else if("string"!=typeof t)throw new TypeError("missing id");else if("object"!=typeof r)throw new TypeError("missing iceParameters");else if(!Array.isArray(a))throw new TypeError("missing iceCandidates");else if("object"!=typeof n)throw new TypeError("missing dtlsParameters");else if(o&&"object"!=typeof o)throw new TypeError("wrong sctpParameters");else if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");const m=new i({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:o,iceServers:d,iceTransportPolicy:c,proprietaryConstraints:p,appData:l,Handler:this._Handler,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return m}}t.exports=y},{"./Logger":45,"./Transport":47,"./detectDevice":48,"./errors":49,"./handlers/Chrome55":50,"./handlers/Chrome67":51,"./handlers/Chrome70":52,"./handlers/Chrome74":53,"./handlers/Edge11":54,"./handlers/Firefox60":55,"./handlers/ReactNative":56,"./handlers/Safari11":57,"./handlers/Safari12":58,"./ortc":66}],44:[function(e,t){const{EventEmitter:r}=e("events"),a=e("./Logger");t.exports=class extends r{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new a("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}async safeEmitAsPromise(e,...t){return new Promise((r,a)=>{this.safeEmit(e,...t,r,a)})}}},{"./Logger":45,events:35}],45:[function(e,t){const r=e("debug"),a="mediasoup-client";class s{constructor(e){e?(this._debug=r(`${a}:${e}`),this._warn=r(`${a}:WARN:${e}`),this._error=r(`${a}:ERROR:${e}`)):(this._debug=r(a),this._warn=r(`${a}:WARN`),this._error=r(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}t.exports=s},{debug:36}],46:[function(e,t){const r=e("./Logger"),a=e("./EnhancedEventEmitter"),{UnsupportedError:s,InvalidStateError:n}=e("./errors"),o=new r("Producer");class i extends a{constructor({id:e,localId:t,track:r,rtpParameters:a,appData:s}){super(o),this._id=e,this._localId=t,this._closed=!1,this._track=r,this._rtpParameters=a,this._paused=!r.enabled,this._maxSpatialLayer=void 0,this._appData=s,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._track.kind}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(){this._closed||(o.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"))}async getStats(){if(this._closed)throw new n("closed");return this.safeEmitAsPromise("@getstats")}pause(){return o.debug("pause()"),this._closed?void o.error("pause() | Producer closed"):void(this._paused=!0,this._track.enabled=!1)}resume(){return o.debug("resume()"),this._closed?void o.error("resume() | Producer closed"):void(this._paused=!1,this._track.enabled=!0)}async replaceTrack({track:e}={}){if(o.debug("replaceTrack() [track:%o]",e),this._closed){try{e.stop()}catch(e){}throw new n("closed")}else if(!e)throw new TypeError("missing track");else if("ended"===e.readyState)throw new n("track ended");await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track.enabled=!this._paused,this._handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new n("closed");else if("video"!==this._track.kind)throw new s("not a video Producer");else if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e===this._maxSpatialLayer||(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}_onTrackEnded(){o.debug("track \"ended\" event"),this.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}t.exports=i},{"./EnhancedEventEmitter":44,"./Logger":45,"./errors":49}],47:[function(e,t){const r=e("awaitqueue"),a=e("./Logger"),s=e("./EnhancedEventEmitter"),{UnsupportedError:n,InvalidStateError:o}=e("./errors"),i=e("./ortc"),d=e("./Producer"),c=e("./Consumer"),p=e("./DataProducer"),l=e("./DataConsumer"),m=new a("Transport");class u extends s{constructor({direction:e,id:t,iceParameters:a,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:d,iceTransportPolicy:c,proprietaryConstraints:p,appData:l,Handler:u,extendedRtpCapabilities:f,canProduceByKind:g}){super(m),m.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._closed=!1,this._direction=e,this._extendedRtpCapabilities=f,this._canProduceByKind=g,this._maxSctpMessageSize=i?i.maxMessageSize:null,this._handler=new u({direction:e,iceParameters:a,iceCandidates:s,dtlsParameters:n,sctpParameters:i,iceServers:d,iceTransportPolicy:c,proprietaryConstraints:p,extendedRtpCapabilities:f}),this._connectionState="new",this._appData=l,this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new r({ClosedErrorClass:o}),this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}close(){if(!this._closed){m.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear()}}async getStats(){if(this._closed)throw new o("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}={}){if(m.debug("restartIce()"),this._closed)throw new o("closed");else if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce({iceParameters:e}))}async updateIceServers({iceServers:e}={}){if(m.debug("updateIceServers()"),this._closed)throw new o("closed");else if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers({iceServers:e}))}async produce({track:e,encodings:t,codecOptions:r,appData:a={}}={}){if(m.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");else if("send"!==this._direction)throw new n("not a sending Transport");else if(!this._canProduceByKind[e.kind])throw new n(`cannot produce ${e.kind}`);else if("ended"===e.readyState)throw new o("track ended");else if(a&&"object"!=typeof a)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let s;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");else t&&0===t.length?s=void 0:t&&(s=t.map(e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),t}));const{localId:n,rtpParameters:o}=await this._handler.send({track:e,encodings:s,codecOptions:r});try{const{id:t}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:o,appData:a}),r=new d({id:t,localId:n,track:e,rtpParameters:o,appData:a});return this._producers.set(r.id,r),this._handleProducer(r),r}catch(e){throw this._handler.stopSending({localId:n}).catch(()=>{}),e}}).catch(t=>{try{e.stop()}catch(e){}throw t})}async consume({id:e,producerId:t,kind:r,rtpParameters:a,appData:s={}}={}){if(m.debug("consume()"),this._closed)throw new o("closed");else if("recv"!==this._direction)throw new n("not a receiving Transport");else if("string"!=typeof e)throw new TypeError("missing id");else if("string"!=typeof t)throw new TypeError("missing producerId");else if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind "${r}"`);else if("object"!=typeof a)throw new TypeError("missing rtpParameters");else if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{const o=i.canReceive(a,this._extendedRtpCapabilities);if(!o)throw new n("cannot consume this Producer");const{localId:d,track:p}=await this._handler.receive({id:e,kind:r,rtpParameters:a}),l=new c({id:e,localId:d,producerId:t,track:p,rtpParameters:a,appData:s});if(this._consumers.set(l.id,l),this._handleConsumer(l),!this._probatorConsumerCreated&&"video"===r)try{const e=i.generateProbatorRtpParameters(l.rtpParameters);await this._handler.receive({id:"probator",kind:"video",rtpParameters:e}),m.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){m.warn("consume() | failed to create Consumer for RTP probation:%o",e)}return l})}async produceData({ordered:r=!0,maxPacketLifeTime:e,maxRetransmits:t,priority:a="low",label:s="",protocol:o="",appData:i={}}={}){if(m.debug("produceData()"),"send"!==this._direction)throw new n("not a sending Transport");else if(!this._maxSctpMessageSize)throw new n("SCTP not enabled by remote Transport");else if(!["very-low","low","medium","high"].includes(a))throw new TypeError("wrong priority");else if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(e||t)&&(r=!1),this._awaitQueue.push(async()=>{const{dataChannel:n,sctpStreamParameters:d}=await this._handler.sendDataChannel({ordered:r,maxPacketLifeTime:e,maxRetransmits:t,priority:a,label:s,protocol:o}),{id:c}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:d,label:s,protocol:o,appData:i}),l=new p({id:c,dataChannel:n,sctpStreamParameters:d,appData:i});return this._dataProducers.set(l.id,l),this._handleDataProducer(l),l})}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:a="",protocol:s="",appData:i={}}={}){if(m.debug("consumeData()"),this._closed)throw new o("closed");else if("recv"!==this._direction)throw new n("not a receiving Transport");else if(!this._maxSctpMessageSize)throw new n("SCTP not enabled by remote Transport");else if("string"!=typeof e)throw new TypeError("missing id");else if("string"!=typeof t)throw new TypeError("missing dataProducerId");else if("object"!=typeof r)throw new TypeError("missing sctpStreamParameters");else if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{const{dataChannel:n}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:a,protocol:s}),o=new l({id:e,dataProducerId:t,dataChannel:n,sctpStreamParameters:r,appData:i});return this._dataConsumers.set(o.id,o),this._handleDataConsumer(o),o})}_handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>this._closed?void r(new o("closed")):void this.safeEmit("connect",{dtlsParameters:e},t,r)),e.on("@connectionstatechange",e=>{e===this._connectionState||(m.debug("connection state changed to %s",e),this._connectionState=e,!this._closed&&this.safeEmit("connectionstatechange",e))})}_handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id);this._closed||this._awaitQueue.push(async()=>this._handler.stopSending({localId:e.localId})).catch(e=>m.warn("producer.close() failed:%o",e))}),e.on("@replacetrack",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack({localId:e.localId,track:t})).then(r).catch(a)}),e.on("@setmaxspatiallayer",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer({localId:e.localId,spatialLayer:t})).then(r).catch(a)}),e.on("@getstats",(t,r)=>this._closed?r(new o("closed")):void this._handler.getSenderStats({localId:e.localId}).then(t).catch(r))}_handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id);this._closed||this._awaitQueue.push(async()=>this._handler.stopReceiving({localId:e.localId})).catch(()=>{})}),e.on("@getstats",(t,r)=>this._closed?r(new o("closed")):void this._handler.getReceiverStats({localId:e.localId}).then(t).catch(r))}_handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}_handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}t.exports=u},{"./Consumer":40,"./DataConsumer":41,"./DataProducer":42,"./EnhancedEventEmitter":44,"./Logger":45,"./Producer":46,"./errors":49,"./ortc":66,awaitqueue:33}],48:[function(e,t){const r=e("bowser"),a=e("./Logger"),s=e("./handlers/Chrome70"),n=e("./handlers/Chrome67"),o=e("./handlers/Chrome55"),i=e("./handlers/Firefox60"),d=e("./handlers/Safari12"),c=e("./handlers/Safari11"),p=e("./handlers/Edge11"),l=e("./handlers/ReactNative"),m=new a("detectDevice");t.exports=function(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?(m.warn("unsupported ReactNative without RTCPeerConnection"),null):l;if("object"==typeof navigator&&"string"==typeof navigator.userAgent){const e=navigator.userAgent,t=r.getParser(e),a=t.getEngine();if(t.satisfies({chrome:">=70",chromium:">=70"}))return s;if(t.satisfies({chrome:">=67",chromium:">=67"}))return n;if(t.satisfies({chrome:">=55",chromium:">=55"}))return o;if(t.satisfies({firefox:">=60"}))return i;if(t.satisfies({safari:">=12.1"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return d;if(t.satisfies({safari:">=11"}))return c;if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return p;if("blink"===a.name.toLowerCase()){m.debug("best effort Chromium based browser detection");const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=+t[1];return 70<=e?s:67<=e?n:o}return s}return m.warn("browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion()),null}return m.warn("unknown device"),null}},{"./Logger":45,"./handlers/Chrome55":50,"./handlers/Chrome67":51,"./handlers/Chrome70":52,"./handlers/Edge11":54,"./handlers/Firefox60":55,"./handlers/ReactNative":56,"./handlers/Safari11":57,"./handlers/Safari12":58,bowser:34}],49:[function(e,t){class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}}class a extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,a):this.stack=new Error(e).stack}}t.exports={UnsupportedError:r,InvalidStateError:a}},{}],50:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),{UnsupportedError:n}=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/planBUtils"),p=e("./sdp/RemoteSdp"),l=new a("Chrome55"),m={OS:1024,MIS:1024};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new p({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,planB:!0}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream,this._mapIdTrack=new Map,this._lastId=0}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._stream.addTrack(e),this._pc.addStream(this._stream);let s=await this._pc.createOffer(),n=r.parse(s.sdp),i;const p=o.clone(this._sendingRtpParametersByKind[e.kind]);if(this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:n})),"video"===e.kind&&t&&1<t.length&&(l.debug("send() | enabling simulcast"),n=r.parse(s.sdp),i=n.media.find(e=>"video"===e.type),c.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:r.write(n)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),n=r.parse(this._pc.localDescription.sdp),i=n.media.find(t=>t.type===e.kind),p.rtcp.cname=d.getCname({offerMediaObject:i}),p.encodings=c.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(1<p.encodings.length&&"video/vp8"===p.codecs[0].mimeType.toLowerCase())for(const e of p.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:p,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._lastId++,this._mapIdTrack.set(this._lastId,e),{localId:this._lastId,rtpParameters:p}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapIdTrack.get(e);if(!t)throw new Error("track not found");this._mapIdTrack.delete(e),this._stream.removeTrack(t),this._pc.addStream(this._stream);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._stream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack({localId:e,track:t}){throw new n("not implemented")}async setMaxSpatialLayer({localId:e,spatialLayer:t}){throw new n("not supported")}async getSenderStats({localId:e}){throw new n("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class g extends u{constructor(e){super(e),this._mapIdRtpParameters=new Map}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=e,n=t,o=a.rtcp.cname;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:a,streamId:o,trackId:s});const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let c=await this._pc.createAnswer();const p=r.parse(c.sdp),m=p.media.find(e=>e.mid+""===n);d.applyCodecParameters({offerRtpParameters:a,answerMediaObject:m}),c={type:"answer",sdp:r.write(p)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:p})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const u=this._pc.getRemoteStreams().find(e=>e.id===o),f=u.getTrackById(s);if(!f)throw new Error("remote track not found");return this._mapIdRtpParameters.set(s,{mid:n,rtpParameters:a}),{localId:s,track:f}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapIdRtpParameters.get(e);this._mapIdRtpParameters.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats({localId:e}){throw new n("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class _{static get name(){return"Chrome55"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const a=r.parse(t.sdp),s=d.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:i.getSendingRtpParameters("audio",c),video:i.getSendingRtpParameters("video",c)},p={audio:i.getSendingRemoteRtpParameters("audio",c),video:i.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../errors":49,"../ortc":66,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/planBUtils":63,"sdp-transform":89}],51:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),{UnsupportedError:n}=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/planBUtils"),p=e("./sdp/RemoteSdp"),l=new a("Chrome67"),m={OS:1024,MIS:1024};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new p({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,planB:!0}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream,this._mapIdTrack=new Map,this._lastId=0}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._stream.addTrack(e),this._pc.addTrack(e,this._stream);let s=await this._pc.createOffer(),n=r.parse(s.sdp),i;const p=o.clone(this._sendingRtpParametersByKind[e.kind]);if(this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:n})),"video"===e.kind&&t&&1<t.length&&(l.debug("send() | enabling simulcast"),n=r.parse(s.sdp),i=n.media.find(e=>"video"===e.type),c.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:r.write(n)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),n=r.parse(this._pc.localDescription.sdp),i=n.media.find(t=>t.type===e.kind),p.rtcp.cname=d.getCname({offerMediaObject:i}),p.encodings=c.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(1<p.encodings.length&&"video/vp8"===p.codecs[0].mimeType.toLowerCase())for(const e of p.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:p,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._lastId++,this._mapIdTrack.set(this._lastId,e),{localId:this._lastId,rtpParameters:p}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapIdTrack.get(e),r=this._pc.getSenders().find(e=>e.track===t);if(!r)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(r),this._stream.removeTrack(t),this._mapIdTrack.delete(e);const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a);try{await this._pc.setLocalDescription(a)}catch(e){if(0===this._stream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack({localId:e,track:t}){l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._mapIdTrack.get(e),a=this._pc.getSenders().find(e=>e.track===r);if(!a)throw new Error("associated RTCRtpSender not found");await a.replaceTrack(t),this._stream.removeTrack(r),this._stream.addTrack(t),this._mapIdTrack.set(e,t)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){throw new n("not supported")}async getSenderStats({localId:e}){const t=this._mapIdTrack.get(e),r=this._pc.getSenders().find(e=>e.track===t);if(!r)throw new Error("associated RTCRtpSender not found");return r.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class g extends u{constructor(e){super(e),this._mapIdRtpParameters=new Map}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=e,n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:s});const o={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let i=await this._pc.createAnswer();const c=r.parse(i.sdp),p=c.media.find(e=>e.mid+""===n);d.applyCodecParameters({offerRtpParameters:a,answerMediaObject:p}),i={type:"answer",sdp:r.write(c)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:c})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const m=this._pc.getReceivers().find(e=>e.track&&e.track.id===s);if(!m)throw new Error("new RTCRtpReceiver not");return this._mapIdRtpParameters.set(s,{mid:n,rtpParameters:a,rtpReceiver:m}),{localId:s,track:m.track}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapIdRtpParameters.get(e);this._mapIdRtpParameters.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats({localId:e}){const{rtpReceiver:t}=this._mapIdRtpParameters.get(e);if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class _{static get name(){return"Chrome67"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const a=r.parse(t.sdp),s=d.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:i.getSendingRtpParameters("audio",c),video:i.getSendingRtpParameters("video",c)},p={audio:i.getSendingRemoteRtpParameters("audio",c),video:i.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../errors":49,"../ortc":66,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/planBUtils":63,"sdp-transform":89}],52:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),n=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/unifiedPlanUtils"),c=e("./sdp/RemoteSdp"),p=e("../scalabilityModes").parse,l=new a("Chrome70"),m={OS:1024,MIS:1024};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new c({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),this._mapMidTransceiver=new Map,this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=i.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._stream]});let c=await this._pc.createOffer(),m=r.parse(c.sdp),u;const f=n.clone(this._sendingRtpParametersByKind[e.kind]);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:m})),t&&1<t.length&&(l.debug("send() | enabling legacy simulcast"),m=r.parse(c.sdp),u=m.media[s.idx],d.addLegacySimulcast({offerMediaObject:u,numStreams:t.length}),c={type:"offer",sdp:r.write(m)});let g=!1;const _=p((t||[{}])[0].scalabilityMode);t&&1===t.length&&1<_.spatialLayers&&"video/vp9"===f.codecs[0].mimeType.toLowerCase()&&(l.debug("send() | enabling legacy simulcast for VP9 SVC"),g=!0,m=r.parse(c.sdp),u=m.media[s.idx],d.addLegacySimulcast({offerMediaObject:u,numStreams:_.spatialLayers}),c={type:"offer",sdp:r.write(m)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const b=o.mid;if(f.mid=b,m=r.parse(this._pc.localDescription.sdp),u=m.media[s.idx],f.rtcp.cname=i.getCname({offerMediaObject:u}),f.encodings=d.getRtpEncodings({offerMediaObject:u}),t)for(let e=0;e<f.encodings.length;++e)t[e]&&Object.assign(f.encodings[e],t[e]);if(g&&(f.encodings=[f.encodings[0]]),1<f.encodings.length&&("video/vp8"===f.codecs[0].mimeType.toLowerCase()||"video/h264"===f.codecs[0].mimeType.toLowerCase()))for(const e of f.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:s.reuseMid,offerRtpParameters:f,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(b,o),{localId:b,rtpParameters:f}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack({localId:e,track:t}){l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.sender.setParameters(a)}async getSenderStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class g extends u{constructor(e){super(e),this._nextMid=0}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=this._nextMid+"";this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let o=await this._pc.createAnswer();const d=r.parse(o.sdp),c=d.media.find(e=>e.mid+""===s);i.applyCodecParameters({offerRtpParameters:a,answerMediaObject:c}),o={type:"answer",sdp:r.write(d)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:d})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===s);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,p),this._nextMid++,{localId:s,track:p.receiver.track}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class _{static get name(){return"Chrome70"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const a=r.parse(t.sdp),s=i.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:o.getSendingRtpParameters("audio",c),video:o.getSendingRtpParameters("video",c)},p={audio:o.getSendingRemoteRtpParameters("audio",c),video:o.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../ortc":66,"../scalabilityModes":67,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/unifiedPlanUtils":64,"sdp-transform":89}],53:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),n=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/unifiedPlanUtils"),c=e("./sdp/RemoteSdp"),p=e("../scalabilityModes").parse,l=new a("Chrome74"),m={OS:1024,MIS:1024};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new c({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),this._mapMidTransceiver=new Map,this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=i.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<t.length&&t.forEach((e,t)=>{e.rid=`r${t}`});const s=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._stream],sendEncodings:t});let c=await this._pc.createOffer(),m=r.parse(c.sdp),u;const f=n.clone(this._sendingRtpParametersByKind[e.kind]);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:m})),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);let g=!1;const _=p((t||[{}])[0].scalabilityMode);t&&1===t.length&&1<_.spatialLayers&&"video/vp9"===f.codecs[0].mimeType.toLowerCase()&&(l.debug("send() | enabling legacy simulcast for VP9 SVC"),g=!0,m=r.parse(c.sdp),u=m.media[s.idx],d.addLegacySimulcast({offerMediaObject:u,numStreams:_.spatialLayers}),c={type:"offer",sdp:r.write(m)}),await this._pc.setLocalDescription(c);const b=o.mid;if(f.mid=b,m=r.parse(this._pc.localDescription.sdp),u=m.media[s.idx],f.rtcp.cname=i.getCname({offerMediaObject:u}),!t)f.encodings=d.getRtpEncodings({offerMediaObject:u});else if(1===t.length){let e=d.getRtpEncodings({offerMediaObject:u});Object.assign(e[0],t[0]),g&&(e=[e[0]]),f.encodings=e}else f.encodings=t;if(1<f.encodings.length&&("video/vp8"===f.codecs[0].mimeType.toLowerCase()||"video/h264"===f.codecs[0].mimeType.toLowerCase()))for(const e of f.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:s.reuseMid,offerRtpParameters:f,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(b,o),{localId:b,rtpParameters:f}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack({localId:e,track:t}){l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.sender.setParameters(a)}async getSenderStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class g extends u{constructor(e){super(e),this._nextMid=0}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=this._nextMid+"";this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let o=await this._pc.createAnswer();const d=r.parse(o.sdp),c=d.media.find(e=>e.mid+""===s);i.applyCodecParameters({offerRtpParameters:a,answerMediaObject:c}),o={type:"answer",sdp:r.write(d)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:d})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===s);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,p),this._nextMid++,{localId:s,track:p.receiver.track}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class _{static get name(){return"Chrome74"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const a=r.parse(t.sdp),s=i.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:o.getSendingRtpParameters("audio",c),video:o.getSendingRtpParameters("video",c)},p={audio:o.getSendingRemoteRtpParameters("audio",c),video:o.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../ortc":66,"../scalabilityModes":67,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/unifiedPlanUtils":64,"sdp-transform":89}],54:[function(e,t){const r=e("../Logger"),a=e("../EnhancedEventEmitter"),{UnsupportedError:s}=e("../errors"),n=e("../utils"),o=e("../ortc"),i=e("./ortc/edgeUtils"),d=new r("Edge11");class c extends a{static get name(){return"Edge11"}static async getNativeRtpCapabilities(){return d.debug("getNativeRtpCapabilities()"),i.getCapabilities()}static async getNativeSctpCapabilities(){return d.debug("getNativeSctpCapabilities()"),{numStreams:0}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,iceServers:s,iceTransportPolicy:i,proprietaryConstraints:c,extendedRtpCapabilities:p}){super(d),d.debug("constructor() [direction:%s]",e),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",p),video:o.getSendingRtpParameters("video",p)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=a,this._transportReady=!1,this._iceGatherer=null,this._iceTransport=null,this._dtlsTransport=null,this._rtpSenders=new Map,this._rtpReceivers=new Map,this._lastSendId=0,this._cname=`CNAME-${n.generateRandomNumber()}`,this._setIceGatherer({iceServers:s,iceTransportPolicy:i}),this._setIceTransport(),this._setDtlsTransport()}close(){d.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t}){d.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||(await this._setupTransport({localDtlsRole:"server"})),d.debug("send() | calling new RTCRtpSender()");const r=new RTCRtpSender(e,this._dtlsTransport),a=n.clone(this._sendingRtpParametersByKind[e.kind]),s=a.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));t||(t=[{}]);for(const r of t)r.ssrc=n.generateRandomNumber(),s&&(r.rtx={ssrc:n.generateRandomNumber()});a.encodings=t,a.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const o=i.mangleRtpParameters(a);return d.debug("send() | calling rtpSender.send() [params:%o]",o),await r.send(o),this._lastSendId++,this._rtpSenders.set(this._lastSendId,r),{localId:this._lastSendId,rtpParameters:a}}async stopSending({localId:e}){d.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{d.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw d.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async replaceTrack({localId:e,track:t}){d.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.track;r.setTrack(t),this._rtpSenders.delete(a.id),this._rtpSenders.set(t.id,r)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){d.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.setParameters(a)}async getSenderStats({localId:e}){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(){throw new s("not implemented")}async receive({id:e,kind:t,rtpParameters:r}){d.debug("receive() [id:%s, kind:%s]",e,t),this._transportReady||(await this._setupTransport({localDtlsRole:"server"})),d.debug("receive() | calling new RTCRtpReceiver()");const a=new RTCRtpReceiver(this._dtlsTransport,t);a.addEventListener("error",e=>{d.error("iceGatherer \"error\" event [event:%o]",e)});const s=i.mangleRtpParameters(r);d.debug("receive() | calling rtpReceiver.receive() [params:%o]",s),await a.receive(s);const n=e;return this._rtpReceivers.set(n,a),{localId:n,track:a.track}}async stopReceiving({localId:e}){d.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{d.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){d.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async getReceiverStats({localId:e}){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(){throw new s("not implemented")}async restartIce({iceParameters:e}){if(d.debug("restartIce()"),this._remoteIceParameters=e,!!this._transportReady){d.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async updateIceServers({iceServers:e}){throw d.debug("updateIceServers()"),new s("not supported")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",e=>{d.error("iceGatherer \"error\" event [event:%o]",e)});try{r.gather()}catch(e){d.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}}),e.addEventListener("candidatepairchange",e=>{d.debug("iceTransport \"candidatepairchange\" event [pair:%o]",e.pair)}),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{d.debug("dtlsTransport \"statechange\" event [state:%s]",e.state)}),e.addEventListener("dtlsstatechange",()=>{d.debug("dtlsTransport \"dtlsstatechange\" event [state:%s]",e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{d.error("dtlsTransport \"error\" event [event:%o]",e)}),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){d.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}t.exports=c},{"../EnhancedEventEmitter":44,"../Logger":45,"../errors":49,"../ortc":66,"../utils":68,"./ortc/edgeUtils":59}],55:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),{UnsupportedError:n}=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/unifiedPlanUtils"),p=e("./sdp/RemoteSdp"),l=new a("Firefox60"),m={OS:16,MIS:2048};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new p({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),this._mapMidTransceiver=new Map,this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){throw l.debug("updateIceServers()"),new n("not supported")}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);let s;t&&1<t.length&&(t.forEach((e,t)=>{e.rid=`r${t}`}),s=o.clone(t).reverse());const n=this._remoteSdp.getNextMediaSectionIdx(),i=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._stream]});if(s){const e=i.sender.getParameters();e.encodings=s,await i.sender.setParameters(e)}const p=await this._pc.createOffer();let m=r.parse(p.sdp);const u=o.clone(this._sendingRtpParametersByKind[e.kind]);this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:m})),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const f=i.mid;u.mid=f,m=r.parse(this._pc.localDescription.sdp);const g=m.media[n.idx];if(u.rtcp.cname=d.getCname({offerMediaObject:g}),!t)u.encodings=c.getRtpEncodings({offerMediaObject:g});else if(1===t.length){const e=c.getRtpEncodings({offerMediaObject:g});Object.assign(e[0],t[0]),u.encodings=e}else u.encodings=t;if(1<u.encodings.length&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase()))for(const e of u.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:g,reuseMid:n.reuseMid,offerRtpParameters:u,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,i),{localId:f,rtpParameters:u}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack({localId:e,track:t}){l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const a=r.sender.getParameters();t=a.encodings.length-1-t,a.encodings.forEach((e,r)=>{e.active=!!(r>=t)}),await r.sender.setParameters(a)}async getSenderStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class g extends u{constructor(e){super(e),this._nextMid=0}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=this._nextMid+"";this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let o=await this._pc.createAnswer();const i=r.parse(o.sdp),c=i.media.find(e=>e.mid+""===s);d.applyCodecParameters({offerRtpParameters:a,answerMediaObject:c}),o={type:"answer",sdp:r.write(i)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:i})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const p=this._pc.getTransceivers().find(e=>e.mid===s);if(!p)throw new Error("new transceiver not found");return this._mapMidTransceiver.set(s,p),this._nextMid++,{localId:s,track:p.receiver.track}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class _{static get name(){return"Firefox60"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const a=t.captureStream(),s=a.getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const a=e.addTransceiver(s,{direction:"sendrecv"}),n=a.sender.getParameters();n.encodings=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],await a.sender.setParameters(n);const o=await e.createOffer();try{t.remove()}catch(e){}try{s.stop()}catch(e){}try{e.close()}catch(e){}const i=r.parse(o.sdp),c=d.extractRtpCapabilities({sdpObject:i});return c}catch(r){try{t.remove()}catch(e){}try{s.stop()}catch(e){}try{e.close()}catch(e){}throw r}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:i.getSendingRtpParameters("audio",c),video:i.getSendingRtpParameters("video",c)},p={audio:i.getSendingRemoteRtpParameters("audio",c),video:i.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../errors":49,"../ortc":66,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/unifiedPlanUtils":64,"sdp-transform":89}],56:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),{UnsupportedError:n}=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/planBUtils"),p=e("./sdp/RemoteSdp"),l=new a("ReactNative"),m={OS:1024,MIS:1024};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new p({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,planB:!0}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream,this._mapIdTrack=new Map,this._lastId=0}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._stream.addTrack(e),this._pc.addStream(this._stream);let s=await this._pc.createOffer(),n=r.parse(s.sdp),i;const p=o.clone(this._sendingRtpParametersByKind[e.kind]);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:n})),"video"===e.kind&&t&&1<t.length&&(l.debug("send() | enabling simulcast"),n=r.parse(s.sdp),i=n.media.find(e=>"video"===e.type),c.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:r.write(n)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",s);const m=new RTCSessionDescription(s);if(await this._pc.setLocalDescription(m),n=r.parse(this._pc.localDescription.sdp),i=n.media.find(t=>t.type===e.kind),p.rtcp.cname=d.getCname({offerMediaObject:i}),p.encodings=c.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(1<p.encodings.length&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase()))for(const e of p.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:p,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",u);const f=new RTCSessionDescription(u);return await this._pc.setRemoteDescription(f),this._lastId++,this._mapIdTrack.set(this._lastId,e),{localId:this._lastId,rtpParameters:p}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapIdTrack.get(e);if(!t)throw new Error("track not found");this._mapIdTrack.delete(e),this._stream.removeTrack(t),this._pc.addStream(this._stream);const r=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._stream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e);const t=new RTCSessionDescription(e);await this._pc.setRemoteDescription(t)}}async replaceTrack({localId:e,track:t}){throw new n("not implemented")}async setMaxSpatialLayer({localId:e,spatialLayer:t}){throw new n("not supported")}async getSenderStats({localId:e}){throw new n("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t);const r=new RTCSessionDescription(t);await this._pc.setRemoteDescription(r)}}}class g extends u{constructor(e){super(e),this._mapIdRtpParameters=new Map}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=e,n=t,o=a.rtcp.cname;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:a,streamId:o,trackId:s});const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i);const c=new RTCSessionDescription(i);await this._pc.setRemoteDescription(c);let p=await this._pc.createAnswer();const m=r.parse(p.sdp),u=m.media.find(e=>e.mid+""===n);d.applyCodecParameters({offerRtpParameters:a,answerMediaObject:u}),p={type:"answer",sdp:r.write(m)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:m})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",p);const f=new RTCSessionDescription(p);await this._pc.setLocalDescription(f);const g=this._pc.getRemoteStreams().find(e=>e.id===o),_=g.getTrackById(s);if(!_)throw new Error("remote track not found");return this._mapIdRtpParameters.set(s,{mid:n,rtpParameters:a}),{localId:s,track:_}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapIdRtpParameters.get(e);this._mapIdRtpParameters.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a);const s=new RTCSessionDescription(a);await this._pc.setRemoteDescription(s);const n=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats({localId:e}){throw new n("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);const t=new RTCSessionDescription(e);await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}}class _{static get name(){return"ReactNative"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const a=r.parse(t.sdp),s=d.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:i.getSendingRtpParameters("audio",c),video:i.getSendingRtpParameters("video",c)},p={audio:i.getSendingRemoteRtpParameters("audio",c),video:i.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../errors":49,"../ortc":66,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/planBUtils":63,"sdp-transform":89}],57:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),{UnsupportedError:n}=e("../errors"),o=e("../utils"),i=e("../ortc"),d=e("./sdp/commonUtils"),c=e("./sdp/planBUtils"),p=e("./sdp/RemoteSdp"),l=new a("Safari11"),m={OS:1024,MIS:1024};class u extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(l),this._transportReady=!1,this._remoteSdp=new p({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,planB:!0}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){l.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class f extends u{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream,this._mapIdTrack=new Map,this._lastId=0}async send({track:e,encodings:t,codecOptions:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._stream.addTrack(e),this._pc.addTrack(e,this._stream);let s=await this._pc.createOffer(),n=r.parse(s.sdp),i;const p=o.clone(this._sendingRtpParametersByKind[e.kind]);if(this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:n})),"video"===e.kind&&t&&1<t.length&&(l.debug("send() | enabling simulcast"),n=r.parse(s.sdp),i=n.media.find(e=>"video"===e.type),c.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),s={type:"offer",sdp:r.write(n)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),n=r.parse(this._pc.localDescription.sdp),i=n.media.find(t=>t.type===e.kind),p.rtcp.cname=d.getCname({offerMediaObject:i}),p.encodings=c.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let e=0;e<p.encodings.length;++e)t[e]&&Object.assign(p.encodings[e],t[e]);if(1<p.encodings.length&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase()))for(const e of p.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:p,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._lastId++,this._mapIdTrack.set(this._lastId,e),{localId:this._lastId,rtpParameters:p}}async stopSending({localId:e}){l.debug("stopSending() [localId:%s]",e);const t=this._mapIdTrack.get(e),r=this._pc.getSenders().find(e=>e.track===t);if(!r)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(r),this._stream.removeTrack(t),this._mapIdTrack.delete(e);const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a);try{await this._pc.setLocalDescription(a)}catch(e){if(0===this._stream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"!==this._pc.signalingState){const e={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}}async replaceTrack({localId:e,track:t}){l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._mapIdTrack.get(e),a=this._pc.getSenders().find(e=>e.track===r);if(!a)throw new Error("associated RTCRtpSender not found");await a.replaceTrack(t),this._stream.removeTrack(r),this._stream.addTrack(t),this._mapIdTrack.set(e,t)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){throw new n("not supported")}async getSenderStats({localId:e}){const t=this._mapIdTrack.get(e),r=this._pc.getSenders().find(e=>e.track===t);if(!r)throw new Error("associated RTCRtpSender not found");return r.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){l.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:n,priority:o};l.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class g extends u{constructor(e){super(e),this._mapIdRtpParameters=new Map}async receive({id:e,kind:t,rtpParameters:a}){l.debug("receive() [id:%s, kind:%s]",e,t);const s=e,n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:s});const o={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let i=await this._pc.createAnswer();const c=r.parse(i.sdp),p=c.media.find(e=>e.mid+""===n);d.applyCodecParameters({offerRtpParameters:a,answerMediaObject:p}),i={type:"answer",sdp:r.write(c)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:c})),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const m=this._pc.getReceivers().find(e=>e.track&&e.track.id===s);if(!m)throw new Error("new RTCRtpReceiver not");return this._mapIdRtpParameters.set(s,{mid:n,rtpParameters:a,rtpReceiver:m}),{localId:s,track:m.track}}async stopReceiving({localId:e}){l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapIdRtpParameters.get(e);this._mapIdRtpParameters.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const s=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats({localId:e}){const{rtpReceiver:t}=this._mapIdRtpParameters.get(e);if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){l.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i,protocol:a};l.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async restartIce({iceParameters:e}){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class _{static get name(){return"Safari11"}static async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const a=r.parse(t.sdp),s=d.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:m}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(l.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:i.getSendingRtpParameters("audio",c),video:i.getSendingRtpParameters("video",c)},p={audio:i.getSendingRemoteRtpParameters("audio",c),video:i.getSendingRemoteRtpParameters("video",c)};return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new g({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:o,proprietaryConstraints:d});}}}t.exports=_},{"../EnhancedEventEmitter":44,"../Logger":45,"../errors":49,"../ortc":66,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/planBUtils":63,"sdp-transform":89}],58:[function(e,t){const r=e("sdp-transform"),a=e("../Logger"),s=e("../EnhancedEventEmitter"),n=e("../utils"),o=e("../ortc"),i=e("./sdp/commonUtils"),d=e("./sdp/unifiedPlanUtils"),c=e("./sdp/RemoteSdp"),p=new a("Safari12"),l={OS:1024,MIS:1024};class m extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,iceServers:s,iceTransportPolicy:n,proprietaryConstraints:o}){super(p),this._transportReady=!1,this._remoteSdp=new c({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a}),this._pc=new RTCPeerConnection({iceServers:s||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),this._mapMidTransceiver=new Map,this._hasDataChannelMediaSection=!1,this._nextSctpStreamId=0,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");}})}close(){p.debug("close()");try{this._pc.close()}catch(e){}}async getTransportStats(){return this._pc.getStats()}async updateIceServers({iceServers:e}){p.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async _setupTransport({localDtlsRole:e,localSdpObject:t=null}){t||(t=r.parse(this._pc.localDescription.sdp));const a=i.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}}class u extends m{constructor(e){super(e),this._sendingRtpParametersByKind=e.sendingRtpParametersByKind,this._sendingRemoteRtpParametersByKind=e.sendingRemoteRtpParametersByKind,this._stream=new MediaStream}async send({track:e,encodings:t,codecOptions:a}){p.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const s=this._remoteSdp.getNextMediaSectionIdx(),o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._stream]});let c=await this._pc.createOffer(),l=r.parse(c.sdp),m;const u=n.clone(this._sendingRtpParametersByKind[e.kind]);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:l})),t&&1<t.length&&(p.debug("send() | enabling legacy simulcast"),l=r.parse(c.sdp),m=l.media[s.idx],d.addLegacySimulcast({offerMediaObject:m,numStreams:t.length}),c={type:"offer",sdp:r.write(l)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const f=o.mid;if(u.mid=f,l=r.parse(this._pc.localDescription.sdp),m=l.media[s.idx],u.rtcp.cname=i.getCname({offerMediaObject:m}),u.encodings=d.getRtpEncodings({offerMediaObject:m}),t)for(let e=0;e<u.encodings.length;++e)t[e]&&Object.assign(u.encodings[e],t[e]);if(1<u.encodings.length&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase()))for(const e of u.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:m,reuseMid:s.reuseMid,offerRtpParameters:u,answerRtpParameters:this._sendingRemoteRtpParametersByKind[e.kind],codecOptions:a});const g={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g),this._mapMidTransceiver.set(f,o),{localId:f,rtpParameters:u}}async stopSending({localId:e}){p.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack({localId:e,track:t}){p.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer({localId:e,spatialLayer:t}){p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((e,r)=>{e.active=!!(r<=t)}),await r.sender.setParameters(a)}async getSenderStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:n,priority:o}){p.debug("sendDataChannel()");const i={negotiated:!0,id:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:n,priority:o};p.debug("DataChannel options:%o",i);const d=this._pc.createDataChannel(s,i);if(this._nextSctpStreamId=++this._nextSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=r.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||(await this._setupTransport({localDtlsRole:"server",localSdpObject:t})),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}const c={streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits};return{dataChannel:d,sctpStreamParameters:c}}async restartIce({iceParameters:e}){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}}}class f extends m{constructor(e){super(e),this._nextMid=0}async receive({id:e,kind:t,rtpParameters:a}){p.debug("receive() [id:%s, kind:%s]",e,t);const s=this._nextMid+"";this._remoteSdp.receive({mid:s,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let o=await this._pc.createAnswer();const d=r.parse(o.sdp),c=d.media.find(e=>e.mid+""===s);i.applyCodecParameters({offerRtpParameters:a,answerMediaObject:c}),o={type:"answer",sdp:r.write(d)},this._transportReady||(await this._setupTransport({localDtlsRole:"client",localSdpObject:d})),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const l=this._pc.getTransceivers().find(e=>e.mid===s);if(!l)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(s,l),this._nextMid++,{localId:s,track:l.receiver.track}}async stopReceiving({localId:e}){p.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){p.debug("receiveDataChannel()");const{streamId:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i}=e,d={negotiated:!0,id:s,ordered:n,maxPacketLifeTime:o,maxRetransmits:i,protocol:a};p.debug("DataChannel options:%o",d);const c=this._pc.createDataChannel(t,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=r.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:c}}async getReceiverStats({localId:e}){const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async restartIce({iceParameters:e}){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady){const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}}class g{static get name(){return"Safari12"}static async getNativeRtpCapabilities(){p.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const a=r.parse(t.sdp),s=i.extractRtpCapabilities({sdpObject:a});return s}catch(t){try{e.close()}catch(e){}throw t}}static async getNativeSctpCapabilities(){return p.debug("getNativeSctpCapabilities()"),{numStreams:l}}constructor({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d,extendedRtpCapabilities:c}){switch(p.debug("constructor() [direction:%s]",e),e){case"send":{const e={audio:o.getSendingRtpParameters("audio",c),video:o.getSendingRtpParameters("video",c)},p={audio:o.getSendingRemoteRtpParameters("audio",c),video:o.getSendingRemoteRtpParameters("video",c)};return new u({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d,sendingRtpParametersByKind:e,sendingRemoteRtpParametersByKind:p})}case"recv":return new f({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:s,iceServers:n,iceTransportPolicy:i,proprietaryConstraints:d});}}}t.exports=g},{"../EnhancedEventEmitter":44,"../Logger":45,"../ortc":66,"../utils":68,"./sdp/RemoteSdp":61,"./sdp/commonUtils":62,"./sdp/unifiedPlanUtils":64,"sdp-transform":89}],59:[function(e,t,r){const a=e("../../utils");r.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=a.clone(e);for(const e of t.codecs){if(e.channels=e.numChannels,delete e.numChannels,"audio"===e.kind?!e.channels&&(e.channels=1):delete e.channels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=+t.apt),t["packetization-mode"]&&(t["packetization-mode"]=+t["packetization-mode"])}for(const t of e.rtcpFeedback||[])t.parameter||delete t.parameter}return t},r.mangleRtpParameters=function(e){const t=a.clone(e);t.mid&&(t.muxId=t.mid,delete t.mid);for(const r of t.codecs)r.channels&&(r.numChannels=r.channels,delete r.channels),r.mimeType&&!r.name&&(r.name=r.mimeType.split("/")[1]),delete r.mimeType;return t}},{"../../utils":68}],60:[function(e,t){const r=e("../../utils");class a{constructor({iceParameters:e=void 0,iceCandidates:t=void 0,dtlsParameters:r=void 0,planB:a=!1}={}){if(this._mediaObject={},this._planB=a,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={};t.component=1,t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return this._mediaObject.mid+""}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.ext,delete this._mediaObject.extmapAllowMixed}}t.exports={AnswerMediaSection:class extends a{constructor(e){super(e);const{sctpParameters:t,offerMediaObject:a,offerRtpParameters:s,answerRtpParameters:n,plainRtpParameters:o,codecOptions:i}=e;switch(this._mediaObject.mid=a.mid+"",this._mediaObject.type=a.type,this._mediaObject.protocol=a.protocol,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),a.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of n.codecs){const t={payload:e.payloadType,codec:e.mimeType.replace(/^.*\//,""),rate:e.clockRate};1<e.channels&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const a=r.clone(e.parameters||{});if(i){const{opusStereo:t,opusFec:r,opusDtx:n,opusMaxPlaybackRate:o,videoGoogleStartBitrate:d,videoGoogleMaxBitrate:c,videoGoogleMinBitrate:p}=i,l=s.codecs.find(t=>t.payloadType===e.payloadType);switch(e.mimeType.toLowerCase()){case"audio/opus":{void 0!==t&&(l.parameters["sprop-stereo"]=t?1:0,a.stereo=t?1:0),void 0!==r&&(l.parameters.useinbandfec=r?1:0,a.useinbandfec=r?1:0),void 0!==n&&(l.parameters.usedtx=n?1:0,a.usedtx=n?1:0),void 0!==o&&(a.maxplaybackrate=o);break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{void 0!==d&&(a["x-google-start-bitrate"]=d),void 0!==c&&(a["x-google-max-bitrate"]=c),void 0!==p&&(a["x-google-min-bitrate"]=p);break}}}const n={payload:e.payloadType,config:""};for(const e of Object.keys(a))n.config&&(n.config+=";"),n.config+=`${e}=${a[e]}`;if(n.config&&this._mediaObject.fmtp.push(n),e.rtcpFeedback)for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter||""})}this._mediaObject.payloads=n.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of n.headerExtensions){const t=(a.ext||[]).some(t=>t.uri===e.uri);t&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if("extmap-allow-mixed"===a.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1},this._mediaObject.rids=[];for(const e of a.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of a.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{"number"==typeof a.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=t.port,this._mediaObject.maxMessageSize=t.maxMessageSize):a.sctpmap&&(this._mediaObject.payloads=t.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:t.port,maxMessageSize:t.maxMessageSize});break}}}setDtlsRole(e){"client"===e?this._mediaObject.setup="active":"server"===e?this._mediaObject.setup="passive":"auto"===e?this._mediaObject.setup="actpass":void 0}},OfferMediaSection:class extends a{constructor(e){super(e);const{sctpParameters:t,plainRtpParameters:r,mid:a,kind:s,offerRtpParameters:n,streamId:o,trackId:i,oldDataChannelSpec:d}=e;switch(this._mediaObject.mid=a+"",this._mediaObject.type=s,r?(this._mediaObject.connection={ip:r.ip,version:r.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=r.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=t?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),s){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${o||"-"} ${i}`);for(const e of n.codecs){const t={payload:e.payloadType,codec:e.mimeType.replace(/^.*\//,""),rate:e.clockRate};if(1<e.channels&&(t.encoding=e.channels),this._mediaObject.rtp.push(t),e.parameters){const t={payload:e.payloadType,config:""};for(const r of Object.keys(e.parameters))t.config&&(t.config+=";"),t.config+=`${r}=${e.parameters[r]}`;t.config&&this._mediaObject.fmtp.push(t)}if(e.rtcpFeedback)for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter||""})}this._mediaObject.payloads=n.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of n.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=n.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],n.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:n.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${o||"-"} ${i}`}),r&&(n.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:n.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${o||"-"} ${i}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":{d?(this._mediaObject.payloads=t.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:t.port,maxMessageSize:t.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=t.port,this._mediaObject.maxMessageSize=t.maxMessageSize);break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const a=e.encodings[0],s=a.ssrc,n=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:s,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:s,attribute:"msid",value:`${t||"-"} ${r}`}),n&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${s} ${n}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,a=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==r&&e.id!==a),a&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>`${r} ${a}`!==e.ssrcs))}}}},{"../../utils":68}],61:[function(e,t){const r=e("sdp-transform"),a=e("../../Logger"),{AnswerMediaSection:s,OfferMediaSection:n}=e("./MediaSection"),o=new a("RemoteSdp");t.exports=class{constructor({iceParameters:e=void 0,iceCandidates:t=void 0,dtlsParameters:r=void 0,sctpParameters:a=void 0,plainRtpParameters:s=void 0,planB:n=!1}){if(this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=a,this._plainRtpParameters=s,this._planB=n,this._mediaSections=new Map,this._firstMid=null,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}s&&(this._sdpObject.origin.address=s.ip,this._sdpObject.origin.ipVer=s.ipVersion)}updateIceParameters(e){o.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections.values())t.setIceParameters(e)}updateDtlsRole(e){o.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections.values())t.setDtlsRole(e)}getNextMediaSectionIdx(){let e=-1;for(const t of this._mediaSections.values())if(e++,t.closed)return{idx:e,reuseMid:t.mid};return{idx:this._mediaSections.size,reuseMid:null}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n}){const o=new s({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n});t?this._replaceMediaSection(o,t):this._mediaSections.has(o.mid)?this._replaceMediaSection(o):this._addMediaSection(o)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:s}){if(!this._mediaSections.has(e)){const o=new n({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:s});this._addMediaSection(o)}else{const t=this._mediaSections.get(e);t.planBReceive({offerRtpParameters:r,streamId:a,trackId:s}),this._replaceMediaSection(t)}}disableMediaSection(e){const t=this._mediaSections.get(e);t.disable()}closeMediaSection(e){const t=this._mediaSections.get(e);return e+""===this._firstMid?(o.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e)):void(t.close(),this._regenerateBundleMids())}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._mediaSections.get(e);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new s({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new n({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,r.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.set(e.mid,e),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if(t){const r=new Map;for(const a of this._mediaSections.values())a.mid===t?r.set(e.mid,e):r.set(a.mid,a);this._mediaSections=r,this._regenerateBundleMids()}else this._mediaSections.set(e.mid,e);this._sdpObject.media=Array.from(this._mediaSections.values()).map(e=>e.getObject())}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=Array.from(this._mediaSections.values()).filter(e=>!e.closed).map(e=>e.mid).join(" "))}}},{"../../Logger":45,"./MediaSection":60,"sdp-transform":89}],62:[function(e,t,r){const a=e("sdp-transform");r.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let s=!1,n=!1;for(const o of e.media){const e=o.type;switch(e){case"audio":{if(s)continue;s=!0;break}case"video":{if(n)continue;n=!0;break}default:continue;}for(const r of o.rtp){const a={mimeType:`${e}/${r.codec}`,kind:e,clockRate:r.rate,preferredPayloadType:r.payload,channels:r.encoding,rtcpFeedback:[],parameters:{}};"audio"===a.kind?!a.channels&&(a.channels=1):delete a.channels,t.set(a.preferredPayloadType,a)}for(const e of o.fmtp||[]){const r=a.parseFmtpConfig(e.config),s=t.get(e.payload);s&&(r&&r["profile-level-id"]&&(r["profile-level-id"]=r["profile-level-id"]+""),s.parameters=r)}for(const e of o.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const a={type:e.type,parameter:e.subtype};a.parameter||delete a.parameter,r.rtcpFeedback.push(a)}for(const t of o.ext||[]){const a={kind:e,uri:t.uri,preferredId:t.value};r.push(a)}}const o={codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]};return o},r.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find(e=>e.iceUfrag&&0!==e.port);if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let a;switch(t.setup){case"active":a="client";break;case"passive":a="server";break;case"actpass":a="auto";}const s={role:a,fingerprints:[{algorithm:r.type,value:r.hash}]};return s},r.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find(e=>"cname"===e.attribute);return t?t.value:""},r.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const s of e.codecs){const e=s.mimeType.toLowerCase();if("audio/opus"!==e)continue;const r=(t.rtp||[]).find(e=>e.payload===s.payloadType);if(!r)continue;t.fmtp=t.fmtp||[];let n=t.fmtp.find(e=>e.payload===s.payloadType);n||(n={payload:s.payloadType,config:""},t.fmtp.push(n));const o=a.parseParams(n.config);switch(e){case"audio/opus":{const e=s.parameters["sprop-stereo"];e!==void 0&&(o.stereo=e?1:0);break}}n.config="";for(const e of Object.keys(o))n.config&&(n.config+=";"),n.config+=`${e}=${o[e]}`}}},{"sdp-transform":89}],63:[function(e,t,r){r.getRtpEncodings=function({offerMediaObject:e,track:t}){let r;const a=new Set;for(const s of e.ssrcs||[]){if("msid"!==s.attribute)continue;const e=s.value.split(" ")[1];if(e===t.id){const e=s.id;a.add(e),r||(r=e)}}if(0===a.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const s=new Map;for(const r of e.ssrcGroups||[]){if("FID"!==r.semantics)continue;let[e,t]=r.ssrcs.split(/\s+/);e=+e,t=+t,a.has(e)&&(a.delete(e),a.delete(t),s.set(e,t))}for(const r of a)s.set(r,null);const n=[];for(const[r,a]of s){const e={ssrc:r};a&&(e.rtx={ssrc:a}),n.push(e)}return n},r.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){if(1>=r)throw new TypeError("numStreams must be greater than 1");let a,s,n;const o=(e.ssrcs||[]).find(e=>{if("msid"!==e.attribute)return!1;const r=e.value.split(" ")[1];if(r===t.id)return a=e.id,n=e.value.split(" ")[0],!0});if(!o)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some(e=>{if("FID"===e.semantics){const t=e.ssrcs.split(/\s+/);if(+t[0]===a)return s=+t[1],!0}});const i=e.ssrcs.find(e=>"cname"===e.attribute&&e.id===a);if(!i)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const d=i.value,c=[],p=[];for(let n=0;n<r;++n)c.push(a+n),s&&p.push(s+n);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let a=0;a<c.length;++a){const r=c[a];e.ssrcs.push({id:r,attribute:"cname",value:d}),e.ssrcs.push({id:r,attribute:"msid",value:`${n} ${t.id}`})}for(let a=0;a<p.length;++a){const r=c[a],s=p[a];e.ssrcs.push({id:s,attribute:"cname",value:d}),e.ssrcs.push({id:s,attribute:"msid",value:`${n} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${s}`})}}},{}],64:[function(e,t,r){r.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const a of e.ssrcGroups||[]){if("FID"!==a.semantics)continue;let[e,s]=a.ssrcs.split(/\s+/);e=+e,s=+s,t.has(e)&&(t.delete(e),t.delete(s),r.set(e,s))}for(const a of t)r.set(a,null);const a=[];for(const[t,s]of r){const e={ssrc:t};s&&(e.rtx={ssrc:s}),a.push(e)}return a},r.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(1>=t)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find(e=>"msid"===e.attribute);if(!r)throw new Error("a=ssrc line with msid information not found");const[a,s]=r.value.split(" ")[0],n=r.id;let o;(e.ssrcGroups||[]).some(e=>{if("FID"===e.semantics){const t=e.ssrcs.split(/\s+/);if(+t[0]===n)return o=+t[1],!0}});const i=e.ssrcs.find(e=>"cname"===e.attribute);if(!i)throw new Error("a=ssrc line with cname information not found");const d=i.value,c=[],p=[];for(let r=0;r<t;++r)c.push(n+r),o&&p.push(o+r);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let r=0;r<c.length;++r){const t=c[r];e.ssrcs.push({id:t,attribute:"cname",value:d}),e.ssrcs.push({id:t,attribute:"msid",value:`${a} ${s}`})}for(let r=0;r<p.length;++r){const t=c[r],n=p[r];e.ssrcs.push({id:n,attribute:"cname",value:d}),e.ssrcs.push({id:n,attribute:"msid",value:`${a} ${s}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${n}`})}}},{}],65:[function(e,t,r){const{version:a}=e("../package.json"),s=e("./Device"),n=e("./scalabilityModes").parse;r.version=a,r.Device=s,r.parseScalabilityMode=n},{"../package.json":69,"./Device":43,"./scalabilityModes":67}],66:[function(e,t,r){function a(e,t,{strict:r=!1,modify:a=!1}={}){const s=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(s!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(/^audio\/.+$/i.test(s)&&(void 0!==e.channels&&1!==e.channels||void 0!==t.channels&&1!==t.channels)&&e.channels!==t.channels)return!1;switch(s){case"video/h264":{const s=(e.parameters||{})["packetization-mode"]||0,n=(t.parameters||{})["packetization-mode"]||0;if(s!==n)return!1;if(r){if(!o.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=o.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}a&&(e.parameters=e.parameters||{},r?e.parameters["profile-level-id"]=r:delete e.parameters["profile-level-id"])}break}case"video/vp9":{if(r){const r=(e.parameters||{})["profile-id"]||0,a=(t.parameters||{})["profile-id"]||0;if(r!==a)return!1}break}}return!0}function s(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind)&&!(e.uri!==t.uri)}function n(e,t){const r=[];for(const a of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find(e=>e.type===a.type&&(e.parameter===a.parameter||!e.parameter&&!a.parameter));e&&r.push(e)}return r}const o=e("h264-profile-level-id");r.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[],fecMechanisms:[]};for(const s of t.codecs||[]){if("object"!=typeof s||Array.isArray(s)||"string"!=typeof s.mimeType||!/^(audio|video)\/(.+)/.test(s.mimeType))throw new TypeError("invalid remote capabilitiy codec");if(/.+\/rtx$/i.test(s.mimeType))continue;const t=(e.codecs||[]).find(e=>a(e,s,{strict:!0,modify:!0}));if(t){const e={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,localPayloadType:t.preferredPayloadType,localRtxPayloadType:null,remotePayloadType:s.preferredPayloadType,remoteRtxPayloadType:null,channels:t.channels,rtcpFeedback:n(t,s),localParameters:t.parameters||{},remoteParameters:s.parameters||{}};e.channels||delete e.channels,r.codecs.push(e)}}for(const a of r.codecs||[]){const r=(e.codecs||[]).find(e=>/.+\/rtx$/i.test(e.mimeType)&&e.parameters.apt===a.localPayloadType),s=(t.codecs||[]).find(e=>/.+\/rtx$/i.test(e.mimeType)&&e.parameters.apt===a.remotePayloadType);r&&s&&(a.localRtxPayloadType=r.preferredPayloadType,a.remoteRtxPayloadType=s.preferredPayloadType)}for(const a of t.headerExtensions||[]){const t=(e.headerExtensions||[]).find(e=>s(e,a));if(t){const e={kind:a.kind,uri:a.uri,sendId:t.preferredId,recvId:a.preferredId,direction:"sendrecv"};switch(a.direction){case"recvonly":e.direction="sendonly";break;case"sendonly":e.direction="recvonly";break;case"inactive":e.direction="inactive";break;default:e.direction="sendrecv";}r.headerExtensions.push(e)}}return r},r.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[],fecMechanisms:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,clockRate:r.clockRate,preferredPayloadType:r.remotePayloadType,channels:r.channels,rtcpFeedback:r.rtcpFeedback,parameters:r.localParameters};if(e.channels||delete e.channels,t.codecs.push(e),r.remoteRtxPayloadType){const e={mimeType:`${r.kind}/rtx`,kind:r.kind,clockRate:r.clockRate,preferredPayloadType:r.remoteRtxPayloadType,rtcpFeedback:[],parameters:{apt:r.remotePayloadType}};t.codecs.push(e)}}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId};t.headerExtensions.push(e)}return t.fecMechanisms=e.fecMechanisms,t},r.getSendingRtpParameters=function(e,t){const r={mid:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,clockRate:a.clockRate,payloadType:a.localPayloadType,channels:a.channels,rtcpFeedback:a.rtcpFeedback,parameters:a.localParameters};if(t.channels||delete t.channels,r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,clockRate:a.clockRate,payloadType:a.localRtxPayloadType,rtcpFeedback:[],parameters:{apt:a.localPayloadType}};r.codecs.push(e)}break}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId};r.headerExtensions.push(t)}return r},r.getSendingRemoteRtpParameters=function(e,t){const r={mid:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,clockRate:a.clockRate,payloadType:a.localPayloadType,channels:a.channels,rtcpFeedback:a.rtcpFeedback,parameters:a.remoteParameters};if(t.channels||delete t.channels,r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,clockRate:a.clockRate,payloadType:a.localRtxPayloadType,rtcpFeedback:[],parameters:{apt:a.localPayloadType}};r.codecs.push(e)}break}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId};r.headerExtensions.push(t)}if(r.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter(e=>"goog-remb"!==e.type);else if(r.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type);else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return r},r.canSend=function(e,t){return t.codecs.some(t=>t.kind===e)},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===r.payloadType)},r.generateProbatorRtpParameters=function(e){const t={mid:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.headerExtensions=e.headerExtensions.filter(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri||"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri),t.encodings.push({ssrc:1234}),t}},{"h264-profile-level-id":38}],67:[function(e,t,r){const a=/^[LS]([1-9]\d{0,1})T([1-9]\d{0,1})/;r.parse=function(e){const t=a.exec(e);return t?{spatialLayers:+t[1],temporalLayers:+t[2]}:{spatialLayers:1,temporalLayers:1}}},{}],68:[function(e,t,a){a.clone=function(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):{}},a.generateRandomNumber=function(){return r(1e7*Math.random())}},{}],69:[function(e,t){t.exports={_from:"github:versatica/mediasoup-client#v3",_id:"mediasoup-client@3.2.6",_inBundle:!1,_integrity:"",_location:"/mediasoup-client",_phantomChildren:{},_requested:{type:"git",raw:"mediasoup-client@github:versatica/mediasoup-client#v3",name:"mediasoup-client",escapedName:"mediasoup-client",rawSpec:"github:versatica/mediasoup-client#v3",saveSpec:"github:versatica/mediasoup-client#v3",fetchSpec:null,gitCommittish:"v3"},_requiredBy:["/"],_resolved:"github:versatica/mediasoup-client#47193233bf0b98bb6296ba59780cdacf499c9aaa",_spec:"mediasoup-client@github:versatica/mediasoup-client#v3",_where:"/home/alexey/Desktop/Projects/JS/easy-mediasoup-v3-client/app",author:{name:"I\xF1aki Baz Castillo",email:"ibc@aliax.net",url:"https://inakibaz.me"},bugs:{url:"https://github.com/versatica/mediasoup-client/issues"},bundleDependencies:!1,contributors:[{name:"Jos\xE9 Luis Mill\xE1n",email:"jmillan@aliax.net",url:"https://github.com/jmillan"}],dependencies:{awaitqueue:"^1.0.0",bowser:"^2.6.1",debug:"^4.1.1",events:"^3.0.0","h264-profile-level-id":"^1.0.0","open-cli":"^5.0.0","sdp-transform":"^2.12.0"},deprecated:!1,description:"mediasoup client side JavaScript library",devDependencies:{eslint:"^6.4.0","eslint-plugin-jest":"^22.17.0",jest:"^24.9.0","jest-tobetype":"^1.2.3","node-mediastreamtrack":"0.1.0",uuid:"^3.3.3"},engines:{node:">=8.6.0"},homepage:"https://mediasoup.org",jest:{verbose:!0,testEnvironment:"node",testRegex:"test/test.*\\.js"},license:"ISC",main:"lib/index.js",name:"mediasoup-client",repository:{type:"git",url:"git+https://github.com/versatica/mediasoup-client.git"},scripts:{coverage:"jest --coverage && open-cli coverage/lcov-report/index.html",lint:"eslint -c .eslintrc.js lib test",test:"jest"},version:"3.2.6"}},{}],70:[function(t,a){function s(e){if(e+="",!(100<e.length)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),a=(t[2]||"ms").toLowerCase();return"years"===a||"year"===a||"yrs"===a||"yr"===a||"y"===a?31557600000*r:"weeks"===a||"week"===a||"w"===a?604800000*r:"days"===a||"day"===a||"d"===a?86400000*r:"hours"===a||"hour"===a||"hrs"===a||"hr"===a||"h"===a?3600000*r:"minutes"===a||"minute"===a||"mins"===a||"min"===a||"m"===a?60000*r:"seconds"===a||"second"===a||"secs"===a||"sec"===a||"s"===a?1000*r:"milliseconds"===a||"millisecond"===a||"msecs"===a||"msec"===a||"ms"===a?r:void 0}}}function n(t){var a=e(t);return 86400000<=a?r(t/86400000)+"d":3600000<=a?r(t/3600000)+"h":60000<=a?r(t/60000)+"m":1000<=a?r(t/1000)+"s":t+"ms"}function o(t){var r=e(t);return 86400000<=r?i(t,r,86400000,"day"):3600000<=r?i(t,r,3600000,"hour"):60000<=r?i(t,r,60000,"minute"):1000<=r?i(t,r,1000,"second"):t+" ms"}function i(e,t,a,s){return r(e/a)+" "+s+(t>=1.5*a?"s":"")}var c=24*(60*60000);a.exports=function(e,t){t=t||{};var r=typeof e;if("string"==r&&0<e.length)return s(e);if("number"===r&&isFinite(e))return t.long?o(e):n(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],71:[function(e,t){function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(m===setTimeout)return setTimeout(t,0);if((m===r||!m)&&setTimeout)return m=setTimeout,setTimeout(t,0);try{return m(t,0)}catch(r){try{return m.call(null,t,0)}catch(r){return m.call(this,t,0)}}}function n(t){if(u===clearTimeout)return clearTimeout(t);if((u===a||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{return u(t)}catch(r){try{return u.call(null,t)}catch(r){return u.call(this,t)}}}function o(){g&&b&&(g=!1,b.length?f=b.concat(f):_=-1,f.length&&d())}function d(){if(!g){var e=s(o);g=!0;for(var t=f.length;t;){for(b=f,f=[];++_<t;)b&&b[_].run();_=-1,t=f.length}b=null,g=!1,n(e)}}function c(e,t){this.fun=e,this.array=t}function p(){}var l=t.exports={},m,u;(function(){try{m="function"==typeof setTimeout?setTimeout:r}catch(t){m=r}try{u="function"==typeof clearTimeout?clearTimeout:a}catch(t){u=a}})();var f=[],g=!1,_=-1,b;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new c(e,t)),1!==f.length||g||s(d)},c.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=p,l.addListener=p,l.once=p,l.off=p,l.removeListener=p,l.removeAllListeners=p,l.emit=p,l.prependListener=p,l.prependOnceListener=p,l.listeners=function(){return[]},l.binding=function(){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],72:[function(e,t,r){arguments[4][44][0].apply(r,arguments)},{"./Logger":73,dup:44,events:35}],73:[function(e,t){const r=e("debug"),a="protoo-client";class s{constructor(e){e?(this._debug=r(`${a}:${e}`),this._warn=r(`${a}:WARN:${e}`),this._error=r(`${a}:ERROR:${e}`)):(this._debug=r(a),this._warn=r(`${a}:WARN`),this._error=r(`${a}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}t.exports=s},{debug:36}],74:[function(e,t){const r=e("./Logger"),{generateRandomNumber:a}=e("./utils"),s=new r("Message");t.exports=class{static parse(e){let t;const r={};try{t=JSON.parse(e)}catch(e){return void s.error("parse() | invalid JSON: %s",e)}if("object"!=typeof t||Array.isArray(t))return void s.error("parse() | not an object");if(t.request){if(r.request=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else if(t.notification){if(r.notification=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}else return void s.error("parse() | missing request/response field");return r}static createRequest(e,t){const r={request:!0,id:a(),method:e,data:t||{}};return r}static createSuccessResponse(e,t){const r={response:!0,id:e.id,ok:!0,data:t||{}};return r}static createErrorResponse(e,t,r){const a={response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r};return a}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},{"./Logger":73,"./utils":78}],75:[function(e,t){const r=e("./Logger"),a=e("./EnhancedEventEmitter"),s=e("./Message"),n=new r("Peer");class o extends a{constructor(e){super(n),n.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){n.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t=void 0){const r=s.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,r.id),await this._transport.send(r),new Promise((e,t)=>{const a=1500*(15+.1*this._sents.size),s={id:r.id,method:r.method,resolve:t=>{this._sents.delete(r.id)&&(clearTimeout(s.timer),e(t))},reject:e=>{this._sents.delete(r.id)&&(clearTimeout(s.timer),t(e))},timer:setTimeout(()=>{this._sents.delete(r.id)&&t(new Error("request timeout"))},a),close:()=>{clearTimeout(s.timer),t(new Error("peer closed"))}};this._sents.set(r.id,s)})}async notify(e,t=void 0){const r=s.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(r)}_handleTransport(){return this._transport.closed?(this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))})):void(this._transport.on("open",()=>{this._closed||(n.debug("emit \"open\""),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(n.debug("emit \"disconnected\""),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(n.debug("emit \"failed\" [currentAttempt:%s]",e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,n.debug("emit \"close\""),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(e){try{this.emit("request",e,t=>{const r=s.createSuccessResponse(e,t);this._transport.send(r).catch(()=>{})},(t,r)=>{t instanceof Error?(t=500,r=t+""):"number"==typeof t&&r instanceof Error&&(r=r+"");const a=s.createErrorResponse(e,t,r);this._transport.send(a).catch(()=>{})})}catch(t){const r=s.createErrorResponse(e,500,t+"");this._transport.send(r).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(!t)return void n.error("received response does not match any sent request [id:%s]",e.id);if(e.ok)t.resolve(e.data);else{const r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}}_handleNotification(e){this.safeEmit("notification",e)}}t.exports=o},{"./EnhancedEventEmitter":72,"./Logger":73,"./Message":74}],76:[function(e,t,r){const{version:a}=e("../package.json"),s=e("./Peer"),n=e("./transports/WebSocketTransport");r.version=a,r.Peer=s,r.WebSocketTransport=n},{"../package.json":79,"./Peer":75,"./transports/WebSocketTransport":77}],77:[function(e,t){const r=e("websocket").w3cwebsocket,a=e("retry"),s=e("../Logger"),n=e("../EnhancedEventEmitter"),o=e("../Message"),i={retries:10,factor:2,minTimeout:1000,maxTimeout:8000},d=new s("WebSocketTransport");class c extends n{constructor(e,t){super(d),d.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){d.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){d.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw d.warn("send() failed:%o",e),e}}_runWebSocket(){const e=a.operation(this._options.retry||i);let t=!1;e.attempt(a=>this._closed?void e.stop():void(d.debug("_runWebSocket() [currentAttempt:%s]",a),this._ws=new r(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=r=>{if(!this._closed){if(d.warn("WebSocket \"close\" event [wasClean:%s, code:%s, reason:\"%s\"]",r.wasClean,r.code,r.reason),4e3!==r.code)if(!t){if(this.safeEmit("failed",a),this._closed)return;if(e.retry(!0))return}else return(e.stop(),this.safeEmit("disconnected"),this._closed)?void 0:void this._runWebSocket();this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||d.error("WebSocket \"error\" event")},this._ws.onmessage=e=>{if(!this._closed){const t=o.parse(e.data);return t?0===this.listenerCount("message")?void d.error("no listeners for WebSocket \"message\" event, ignoring received message"):void this.safeEmit("message",t):void 0}}))}}t.exports=c},{"../EnhancedEventEmitter":72,"../Logger":73,"../Message":74,retry:85,websocket:95}],78:[function(e,t,a){a.generateRandomNumber=function(){return r(1e7*Math.random())}},{}],79:[function(e,t){t.exports={_from:"protoo-client@^4.0.3",_id:"protoo-client@4.0.3",_inBundle:!1,_integrity:"sha512-+HnxpBOOZ8WovllUUvfcbJa3gLuzhyYdR4A+ytldLmwq6vl5AzFGsenyLJMX6pVuNEJUZ5D7M92zvPesUG+wyQ==",_location:"/protoo-client",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"protoo-client@^4.0.3",name:"protoo-client",escapedName:"protoo-client",rawSpec:"^4.0.3",saveSpec:null,fetchSpec:"^4.0.3"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.3.tgz",_shasum:"3cc1943ce160785777fbda4dcceab196328d0bfd",_spec:"protoo-client@^4.0.3",_where:"/home/alexey/Desktop/Projects/JS/easy-mediasoup-v3-client/app",author:{name:"I\xF1aki Baz Castillo",email:"ibc@aliax.net"},bugs:{url:"https://github.com/ibc/protoo/issues"},bundleDependencies:!1,dependencies:{debug:"^4.1.1",events:"^3.0.0",retry:"^0.12.0",websocket:"^1.0.28"},deprecated:!1,description:"protoo JavaScript client module",devDependencies:{eslint:"^5.16.0"},engines:{node:">=8.0.0"},homepage:"https://protoojs.org",keywords:["nodejs","browser","websocket"],license:"MIT",main:"lib/index.js",name:"protoo-client",optionalDependencies:{websocket:"^1.0.28"},repository:{type:"git",url:"git+https://github.com/ibc/protoo.git"},scripts:{lint:"eslint -c .eslintrc.js lib"},version:"4.0.3"}},{}],80:[function(e,t,r){'use strict';function a(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}function s(e){for(var t=/([^=?&]+)=?([^&]*)/g,r={},s;s=t.exec(e);){var n=a(s[1]),o=a(s[2]);null===n||null===o||n in r||(r[n]=o)}return r}var n=Object.prototype.hasOwnProperty,o;r.stringify=function(e,t){t=t||"";var r=[],a,s;for(s in"string"!=typeof t&&(t="?"),e)if(n.call(e,s)){if(a=e[s],!a&&(null===a||a===o||isNaN(a))&&(a=""),s=encodeURIComponent(s),a=encodeURIComponent(a),null===s||null===a)continue;r.push(s+"="+a)}return r.length?t+r.join("&"):""},r.parse=s},{}],81:[function(e,t,r){'use strict';function a(e){return function(t){var r=t.dispatch,a=t.getState;return function(t){return function(s){return"function"==typeof s?s(r,a,e):t(s)}}}}r.__esModule=!0;var s=a();s.withExtraArgument=a,r["default"]=s},{}],82:[function(e,t,r){'use strict';function a(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}function s(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function n(e,t,r){function a(){f===m&&(f=m.slice())}function o(){if(_)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return l}function i(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(_)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return a(),f.push(e),function(){if(t){if(_)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,a();var r=f.indexOf(e);f.splice(r,1)}}}function d(e){if(!s(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error("Actions may not have an undefined \"type\" property. Have you misspelled a constant?");if(_)throw new Error("Reducers may not dispatch actions.");try{_=!0,l=p(l,e)}finally{_=!1}for(var t=m=f,r=0,a;r<t.length;r++)a=t[r],a();return e}var c;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&"undefined"==typeof r&&(r=t,t=void 0),"undefined"!=typeof r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(n)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var p=e,l=t,m=[],f=m,_=!1;return d({type:g.INIT}),c={dispatch:d,subscribe:i,getState:o,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");p=e,d({type:g.REPLACE})}},c[u]=function(){var e=i,t;return t={subscribe:function(t){function r(){t.next&&t.next(o())}if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");r();var a=e(r);return{unsubscribe:a}}},t[u]=function(){return this},t},c}function o(e,t){var r=t&&t.type;return"Given "+(r&&"action \""+(r+"")+"\""||"an action")+", reducer \""+e+"\" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined."}function i(e){Object.keys(e).forEach(function(t){var r=e[t],a=r(void 0,{type:g.INIT});if("undefined"==typeof a)throw new Error("Reducer \""+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if("undefined"==typeof r(void 0,{type:g.PROBE_UNKNOWN_ACTION()}))throw new Error("Reducer \""+t+"\" returned undefined when probed with a random type. "+("Don't try to handle "+g.INIT+" or other actions in \"redux/*\" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null."))})}function d(e,t){return function(){return t(e.apply(this,arguments))}}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function l(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?p(r,!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}function m(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}Object.defineProperty(r,"__esModule",{value:!0});var u=a(e("symbol-observable")),f=function(){return Math.random().toString(36).substring(7).split("").join(".")},g={INIT:"@@redux/INIT"+f(),REPLACE:"@@redux/REPLACE"+f(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+f()}};!1,r.__DO_NOT_USE__ActionTypes=g,r.applyMiddleware=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),a=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},s={getState:r.getState,dispatch:function(){return a.apply(void 0,arguments)}},n=t.map(function(e){return e(s)});return a=m.apply(void 0,n)(r.dispatch),l({},r,{dispatch:a})}}},r.bindActionCreators=function(e,t){if("function"==typeof e)return d(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+". Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?");var r={};for(var a in e){var s=e[a];"function"==typeof s&&(r[a]=d(s,t))}return r},r.combineReducers=function(e){for(var t=Object.keys(e),r={},a=0,s;a<t.length;a++)s=t[a],!1,"function"==typeof e[s]&&(r[s]=e[s]);var n=Object.keys(r);var d;try{i(r)}catch(t){d=t}return function(e,t){if(void 0===e&&(e={}),d)throw d;for(var a=!1,s={},i=0;i<n.length;i++){var c=n[i],p=r[c],l=e[c],m=p(l,t);if("undefined"==typeof m){var u=o(c,t);throw new Error(u)}s[c]=m,a=a||m!==l}return a?s:e}},r.compose=m,r.createStore=n},{"symbol-observable":92}],83:[function(e,t){var r=function(e){"use strict";function t(e,t,r,s){var n=t&&t.prototype instanceof a?t:a,o=Object.create(n.prototype),i=new m(s||[]);return o._invoke=d(e,r,i),o}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function a(){}function s(){}function n(){}function o(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function i(e){function t(a,s,n,o){var i=r(e[a],e,s);if("throw"===i.type)o(i.arg);else{var d=i.arg,c=d.value;return c&&"object"==typeof c&&_.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):Promise.resolve(c).then(function(e){d.value=e,n(d)},function(e){return t("throw",e,n,o)})}}function a(e,r){function a(){return new Promise(function(a,s){t(e,r,a,s)})}return s=s?s.then(a,a):a()}var s;this._invoke=a}function d(e,t,a){var s="suspendedStart";return function(n,o){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===n)throw o;return f()}for(a.method=n,a.arg=o;;){var i=a.delegate;if(i){var d=c(i,a);if(d){if(d===v)continue;return d}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var p=r(e,t,a);if("normal"===p.type){if(s=a.done?"completed":"suspendedYield",p.arg===v)continue;return{value:p.arg,done:a.done}}"throw"===p.type&&(s="completed",a.method="throw",a.arg=p.arg)}}}function c(e,t){var a=e.iterator[t.method];if(void 0===a){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=void 0,c(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var s=r(a,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,v;var n=s.arg;if(!n)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v;if(n.done)t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0);else return n;return t.delegate=null,v}function p(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function l(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function m(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(p,this),this.reset(!0)}function u(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(_.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:f}}function f(){return{value:void 0,done:!0}}var g=Object.prototype,_=g.hasOwnProperty,b="function"==typeof Symbol?Symbol:{},y=b.iterator||"@@iterator",h=b.asyncIterator||"@@asyncIterator",P=b.toStringTag||"@@toStringTag";e.wrap=t;var v={},S={};S[y]=function(){return this};var R=Object.getPrototypeOf,C=R&&R(R(u([])));C&&C!==g&&_.call(C,y)&&(S=C);var x=n.prototype=a.prototype=Object.create(S);return s.prototype=x.constructor=n,n.constructor=s,n[P]=s.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===s||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,n):(e.__proto__=n,!(P in e)&&(e[P]="GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},o(i.prototype),i.prototype[h]=function(){return this},e.AsyncIterator=i,e.async=function(r,a,s,n){var o=new i(t(r,a,s,n));return e.isGeneratorFunction(a)?o:o.next().then(function(e){return e.done?e.value:o.next()})},o(x),x[P]="Generator",x[y]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=u,m.prototype={constructor:m,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(l),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,a){return n.type="throw",n.arg=e,r.next=t,a&&(r.method="next",r.arg=void 0),!!a}if(this.done)throw e;for(var r=this,a=this.tryEntries.length-1;0<=a;--a){var s=this.tryEntries[a],n=s.completion;if("root"===s.tryLoc)return t("end");if(s.tryLoc<=this.prev){var o=_.call(s,"catchLoc"),d=_.call(s,"finallyLoc");if(o&&d){if(this.prev<s.catchLoc)return t(s.catchLoc,!0);if(this.prev<s.finallyLoc)return t(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return t(s.catchLoc,!0);}else if(!d)throw new Error("try statement without catch or finally");else if(this.prev<s.finallyLoc)return t(s.finallyLoc)}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1,a;0<=r;--r)if(a=this.tryEntries[r],a.tryLoc<=this.prev&&_.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var n=s?s.completion:{};return n.type=e,n.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1,r;0<=t;--t)if(r=this.tryEntries[t],r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),l(r),v},catch:function(e){for(var t=this.tryEntries.length-1,r;0<=t;--t)if(r=this.tryEntries[t],r.tryLoc===e){var a=r.completion;if("throw"===a.type){var s=a.arg;l(r)}return s}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:u(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),v}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},{}],84:[function(e,t){'use strict';t.exports=function(e,t){return(t=t.split(":")[0],e=+e,!!e)&&("http"===t||"ws"===t?80!==e:"https"===t||"wss"===t?443!==e:"ftp"===t?21!==e:"gopher"===t?70!==e:"file"!==t&&0!==e)}},{}],85:[function(e,t){t.exports=e("./lib/retry")},{"./lib/retry":86}],86:[function(e,s,n){var o=e("./retry_operation");n.operation=function(e){var t=n.timeouts(e);return new o(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},n.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1000,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],s=0;s<t.retries;s++)a.push(this.createTimeout(s,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(s,t)),a.sort(function(e,t){return e-t}),a},n.createTimeout=function(e,s){var n=s.randomize?Math.random()+1:1,o=r(n*s.minTimeout*a(s.factor,e));return o=t(o,s.maxTimeout),o},n.wrap=function(e,t,r){if(t instanceof Array&&(r=t,t=null),!r)for(var a in r=[],e)"function"==typeof e[a]&&r.push(a);for(var s=0;s<r.length;s++){var o=r[s],d=e[o];e[o]=function(r){var a=n.operation(t),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push(function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),o.apply(this,arguments))}),a.attempt(function(){r.apply(e,s)})}.bind(e,d),e[o].options=t}}},{"./retry_operation":87}],87:[function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r)if(this._cachedTimeouts)this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift();else return!1;var a=this,s=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r);return this._options.unref&&s.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var s=this._errors[a],n=s.message,o=(e[n]||0)+1;e[n]=o,o>=r&&(t=s,r=o)}return t}},{}],88:[function(e,t){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null==e.address?"rtcp:%d":"rtcp:%d %s IP%d %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null==e.subtype?"rtcp-fb:%s %s":"rtcp-fb:%s %s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null==e.sessionConfig?"crypto:%d %s %s":"crypto:%d %s %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null==e.raddr?"%v%v":" raddr %s rport %d",t+=null==e.tcptype?"%v":" tcptype %s",null!=e.generation&&(t+=" generation %d"),t+=null==e["network-id"]?"%v":" network-id %d",t+=null==e["network-cost"]?"%v":" network-cost %d",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null==e.maxMessageSize?"sctpmap:%s %s":"sctpmap:%s %s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:/^imageattr:(\d+|\*)[\s\t]+(send|recv)[\s\t]+(\*|\[\S+\](?:[\s\t]+\[\S+\])*)(?:[\s\t]+(recv|send)[\s\t]+(\*|\[\S+\](?:[\s\t]+\[\S+\])*))?/,names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:/^simulcast:(send|recv) ([a-zA-Z0-9\-_~;,]+)(?:\s?(send|recv) ([a-zA-Z0-9\-_~;,]+))?$/,names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],89:[function(e,t,r){var a=e("./parser"),s=e("./writer");r.write=s,r.parse=a.parse,r.parseFmtpConfig=a.parseFmtpConfig,r.parseParams=a.parseParams,r.parsePayloads=a.parsePayloads,r.parseRemoteCandidates=a.parseRemoteCandidates,r.parseImageAttributes=a.parseImageAttributes,r.parseSimulcastStreamList=a.parseSimulcastStreamList},{"./parser":90,"./writer":91}],90:[function(e,t,r){var a=function(e){return+e+""===e?+e:e},s=function(e,t,r,s){if(s&&!r)t[s]=a(e[1]);else for(var n=0;n<r.length;n+=1)null!=e[n+1]&&(t[r[n]]=a(e[n+1]))},n=function(e,t,r){var a=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={});var n=e.push?{}:a?t[e.name]:t;s(r.match(e.reg),n,e.names,e.name),e.push&&t[e.push].push(n)},o=e("./grammar"),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var i=0,d;i<(o[t]||[]).length;i+=1)if(d=o[t][i],d.reg.test(s))return n(d,a,s)}),t.media=r,t};var d=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=a(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/;\s?/).reduce(d,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(a),s=0;s<r.length;s+=3)t.push({component:r[s],ip:r[s+1],port:r[s+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(d,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t=!1,r;return"~"===e[0]?(r=a(e.substring(1,e.length)),t=!0):r=a(e),{scid:r,paused:t}})})}},{"./grammar":88}],91:[function(e,t){var r=e("./grammar"),a=/%[sdv%]/g,s=function(e){var t=1,r=arguments,s=r.length;return e.replace(a,function(e){if(t>=s)return e;var a=r[t];return t+=1,"%%"===e?"%":"%s"===e?a+"":"%d"===e?+a:"%v"===e?"":void 0})},n=function(e,t,r){var a=t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format,o=[e+"="+a];if(t.names)for(var d=0,c;d<t.names.length;d+=1)c=t.names[d],t.name?o.push(r[t.name][c]):o.push(r[t.names[d]]);else o.push(r[t.name]);return s.apply(null,o)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],i=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var a=t.outerOrder||o,s=t.innerOrder||i,d=[];return a.forEach(function(t){r[t].forEach(function(r){r.name in e&&null!=e[r.name]?d.push(n(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){d.push(n(t,r,e))})})}),e.media.forEach(function(e){d.push(n("m",r.m[0],e)),s.forEach(function(t){r[t].forEach(function(r){r.name in e&&null!=e[r.name]?d.push(n(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){d.push(n(t,r,e))})})})}),d.join("\r\n")+"\r\n"}},{"./grammar":88}],92:[function(e,t,r){(function(a){'use strict';Object.defineProperty(r,"__esModule",{value:!0});var s=e("./ponyfill.js"),n=function(e){return e&&e.__esModule?e:{default:e}}(s),o;o="undefined"==typeof self?"undefined"==typeof window?"undefined"==typeof a?"undefined"==typeof t?Function("return this")():t:a:window:self;var i=(0,n["default"])(o);r["default"]=i}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./ponyfill.js":93}],93:[function(e,t,r){'use strict';Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=function(e){var t=e.Symbol,r;return"function"==typeof t?t.observable?r=t.observable:(r=t("observable"),t.observable=r):r="@@observable",r}},{}],94:[function(e,t){(function(r){'use strict';function a(e){return(e?e:"").toString().replace(m,"")}function s(e){var t="undefined"==typeof window?"undefined"==typeof r?"undefined"==typeof self?{}:self:r:window;var a=t.location||{};e=e||a;var s={},n=typeof e,o;if("blob:"===e.protocol)s=new d(unescape(e.pathname),{});else if("string"===n)for(o in s=new d(e,{}),f)delete s[o];else if("object"===n){for(o in e)o in f||(s[o]=e[o]);void 0===s.slashes&&(s.slashes=i.test(e.href))}return s}function n(e){e=a(e);var t=l.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function o(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),a=r.length,s=r[a-1],n=!1,o=0;a--;)"."===r[a]?r.splice(a,1):".."===r[a]?(r.splice(a,1),o++):o&&(0===a&&(n=!0),r.splice(a,1),o--);return n&&r.unshift(""),("."===s||".."===s)&&r.push(""),r.join("/")}function d(e,t,r){if(e=a(e),!(this instanceof d))return new d(e,t,r);var l=u.slice(),m=typeof t,f=this,g=0,_,b,y,h,P,v;for("object"!=m&&"string"!==m&&(r=t,t=null),r&&"function"!=typeof r&&(r=p.parse),t=s(t),b=n(e||""),_=!b.protocol&&!b.slashes,f.slashes=b.slashes||_&&t.slashes,f.protocol=b.protocol||t.protocol||"",e=b.rest,b.slashes||(l[3]=[/(.*)/,"pathname"]);g<l.length;g++){if(h=l[g],"function"==typeof h){e=h(e);continue}y=h[0],v=h[1],y===y?"string"==typeof y?~(P=e.indexOf(y))&&("number"==typeof h[2]?(f[v]=e.slice(0,P),e=e.slice(P+h[2])):(f[v]=e.slice(P),e=e.slice(0,P))):(P=y.exec(e))&&(f[v]=P[1],e=e.slice(0,P.index)):f[v]=e,f[v]=f[v]||(_&&h[3]?t[v]||"":""),h[4]&&(f[v]=f[v].toLowerCase())}r&&(f.query=r(f.query)),_&&t.slashes&&"/"!==f.pathname.charAt(0)&&(""!==f.pathname||""!==t.pathname)&&(f.pathname=o(f.pathname,t.pathname)),c(f.port,f.protocol)||(f.host=f.hostname,f.port=""),f.username=f.password="",f.auth&&(h=f.auth.split(":"),f.username=h[0]||"",f.password=h[1]||""),f.origin=f.protocol&&f.host&&"file:"!==f.protocol?f.protocol+"//"+f.host:"null",f.href=f.toString()}var c=e("requires-port"),p=e("querystringify"),i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,m=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,u=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],f={hash:1,query:1};d.prototype={set:function(e,t,r){var a=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||p.parse)(t)),a[e]=t;break;case"port":a[e]=t,c(t,a.protocol)?t&&(a.host=a.hostname+":"+t):(a.host=a.hostname,a[e]="");break;case"hostname":a[e]=t,a.port&&(t+=":"+a.port),a.host=t;break;case"host":a[e]=t,/:\d+$/.test(t)?(t=t.split(":"),a.port=t.pop(),a.hostname=t.join(":")):(a.hostname=t,a.port="");break;case"protocol":a.protocol=t.toLowerCase(),a.slashes=!r;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";a[e]=t.charAt(0)===s?t:s+t}else a[e]=t;break;default:a[e]=t;}for(var n=0,o;n<u.length;n++)o=u[n],o[4]&&(a[o[1]]=a[o[1]].toLowerCase());return a.origin=a.protocol&&a.host&&"file:"!==a.protocol?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=p.stringify);var t=this,r=t.protocol,a;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(t.slashes?"//":"");return t.username&&(s+=t.username,t.password&&(s+=":"+t.password),s+="@"),s+=t.host+t.pathname,a="object"==typeof t.query?e(t.query):t.query,a&&(s+="?"===a.charAt(0)?a:"?"+a),t.hash&&(s+=t.hash),s}},d.extractProtocol=n,d.location=s,d.trimLeft=a,d.qs=p,t.exports=d}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{querystringify:80,"requires-port":84}],95:[function(e,t){(function(r){function a(e,t){var r;return r=t?new n(e,t):new n(e),r}var s=function(){return this||"undefined"==typeof r?this:r}(),n=s.WebSocket||s.MozWebSocket,o=e("./version");n&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(a,e,{get:function(){return n[e]}})}),t.exports={w3cwebsocket:n?a:null,version:o}}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{"./version":96}],96:[function(e,t){t.exports=e("../package.json").version},{"../package.json":97}],97:[function(e,t){t.exports={_from:"websocket@^1.0.28",_id:"websocket@1.0.30",_inBundle:!1,_integrity:"sha512-aO6klgaTdSMkhfl5VVJzD5fm+Srhh5jLYbS15+OiI1sN6h/RU/XW6WN9J1uVIpUKNmsTvT3Hs35XAFjn9NMfOw==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"websocket@^1.0.28",name:"websocket",escapedName:"websocket",rawSpec:"^1.0.28",saveSpec:null,fetchSpec:"^1.0.28"},_requiredBy:["/protoo-client"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.30.tgz",_shasum:"91d3bd00c3d43e916f0cf962f8f8c451bb0b2373",_spec:"websocket@^1.0.28",_where:"/home/alexey/Desktop/Projects/JS/easy-mediasoup-v3-client/app/node_modules/protoo-client",author:{name:"Brian McKelvey",email:"theturtle32@gmail.com",url:"https://github.com/theturtle32"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:!1,config:{verbose:!1},contributors:[{name:"I\xF1aki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.14.0","typedarray-to-buffer":"^3.1.5",yaeti:"^0.0.6"},deprecated:!1,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"^4.0.2","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.9.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.30"}},{}],98:[function(e,t){function r(){}t.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e){this.callbacks=this.callbacks||{};var t=3===arguments.length,r=t?arguments[1]:void 0,a=t?arguments[2]:arguments[1];return a._groupName=r,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e){function t(){r.off(e,t),n.apply(this,arguments)}var r=this,a=3===arguments.length,s=a?arguments[1]:void 0,n=a?arguments[2]:arguments[1];return this.on(e,s,t),this},t.releaseGroup=function(e){this.callbacks=this.callbacks||{};var t,r,a,s;for(t in this.callbacks)for(s=this.callbacks[t],r=0,a=s.length;r<a;r++)s[r]._groupName===e&&(s.splice(r,1),r--,a--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r=this.callbacks[e],a;return r?1===arguments.length?(delete this.callbacks[e],this):(a=r.indexOf(t),-1!==a&&(r.splice(a,1),0===r.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t=[].slice.call(arguments,1),r=this.callbacks[e],a=this.getWildcardCallbacks(e),s,n,o;if(r)for(o=r.slice(),s=0,n=o.length;s<n&&!!o[s];++s)o[s].apply(this,t);if(a)for(n=a.length,o=a.slice(),(s=0,n=o.length);s<n&&!!o[s];++s)o[s].apply(this,[e].concat(t));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t=[],r,a;for(r in this.callbacks)a=r.split("*"),("*"===r||2===a.length&&e.slice(0,a[0].length)===a[0])&&(t=t.concat(this.callbacks[r]));return t}},r.mixin(r)},{}]},{},[5])(5)});